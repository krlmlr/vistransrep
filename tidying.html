<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Tidying | Visualization, transformation and reporting with the tidyverse</title>
  <meta name="description" content="6 Tidying | Visualization, transformation and reporting with the tidyverse" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Tidying | Visualization, transformation and reporting with the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Tidying | Visualization, transformation and reporting with the tidyverse" />
  
  
  

<meta name="author" content="Kirill Müller, Tobias Schieferdecker, Patrick Schratz" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="import.html"/>
<link rel="next" href="best-practices.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/d3/d3.min.js"></script>
<script src="libs/d3-lasso/d3-lasso.min.js"></script>
<link href="libs/ggiraphjs/styles.css" rel="stylesheet" />
<script src="libs/ggiraphjs/ggiraphjs.min.js"></script>
<script src="libs/girafe-binding/girafe.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="scroll.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#links"><i class="fa fa-check"></i>Links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#package-versions-used"><i class="fa fa-check"></i>Package versions used</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#speakers"><i class="fa fa-check"></i>Speakers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> R and RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-as-a-toolkit"><i class="fa fa-check"></i><b>1.1</b> R as a toolkit</a><ul>
<li class="chapter" data-level="1.1.1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#why-r-and-rstudio"><i class="fa fa-check"></i><b>1.1.1</b> Why R and RStudio?</a></li>
<li class="chapter" data-level="1.1.2" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#some-r-basics"><i class="fa fa-check"></i><b>1.1.2</b> Some R basics</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-code-examples"><i class="fa fa-check"></i><b>1.2</b> R code examples</a><ul>
<li class="chapter" data-level="1.2.1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#linear-regression"><i class="fa fa-check"></i><b>1.2.1</b> Linear regression</a></li>
<li class="chapter" data-level="1.2.2" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#base-r-plot"><i class="fa fa-check"></i><b>1.2.2</b> Base R plot</a></li>
<li class="chapter" data-level="1.2.3" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#ggplot2"><i class="fa fa-check"></i><b>1.2.3</b> ggplot2</a></li>
<li class="chapter" data-level="1.2.4" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#gganimate"><i class="fa fa-check"></i><b>1.2.4</b> gganimate</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-vs.rstudio"><i class="fa fa-check"></i><b>1.3</b> R vs. RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-vs.r-packages"><i class="fa fa-check"></i><b>1.4</b> R vs. R packages</a></li>
<li class="chapter" data-level="1.5" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-packages"><i class="fa fa-check"></i><b>1.5</b> R packages</a></li>
<li class="chapter" data-level="1.6" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#rprofile"><i class="fa fa-check"></i><b>1.6</b> .Rprofile</a></li>
<li class="chapter" data-level="1.7" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#renviron"><i class="fa fa-check"></i><b>1.7</b> .Renviron</a></li>
<li class="chapter" data-level="1.8" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#rstudio"><i class="fa fa-check"></i><b>1.8</b> RStudio</a></li>
<li class="chapter" data-level="1.9" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#rstudio-addins"><i class="fa fa-check"></i><b>1.9</b> RStudio Addins</a></li>
<li class="chapter" data-level="1.10" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#rstudio-projects"><i class="fa fa-check"></i><b>1.10</b> RStudio projects</a></li>
<li class="chapter" data-level="1.11" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#alternatives-to-rstudio"><i class="fa fa-check"></i><b>1.11</b> Alternatives to RStudio</a></li>
</ul></li>
<li class="part"><span><b>I Visualization</b></span></li>
<li class="chapter" data-level="2" data-path="vis-basics.html"><a href="vis-basics.html"><i class="fa fa-check"></i><b>2</b> {ggplot2} basics</a><ul>
<li class="chapter" data-level="2.1" data-path="vis-basics.html"><a href="vis-basics.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a><ul>
<li class="chapter" data-level="2.1.1" data-path="vis-basics.html"><a href="vis-basics.html#creating-the-plot-skeleton-ggplot"><i class="fa fa-check"></i><b>2.1.1</b> Creating the plot skeleton: <code>ggplot()</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="vis-basics.html"><a href="vis-basics.html#what-is-a-statistical-graphic"><i class="fa fa-check"></i><b>2.1.2</b> What is a “statistical graphic”?</a></li>
<li class="chapter" data-level="2.1.3" data-path="vis-basics.html"><a href="vis-basics.html#terminology"><i class="fa fa-check"></i><b>2.1.3</b> Terminology</a></li>
<li class="chapter" data-level="2.1.4" data-path="vis-basics.html"><a href="vis-basics.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>2.1.4</b> The Grammar of graphics …</a></li>
<li class="chapter" data-level="2.1.5" data-path="vis-basics.html"><a href="vis-basics.html#about-ggplot2"><i class="fa fa-check"></i><b>2.1.5</b> About {ggplot2}</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="vis-basics.html"><a href="vis-basics.html#geom_-functions"><i class="fa fa-check"></i><b>2.2</b> <code>geom_*</code> functions</a><ul>
<li class="chapter" data-level="2.2.1" data-path="vis-basics.html"><a href="vis-basics.html#arguments"><i class="fa fa-check"></i><b>2.2.1</b> Arguments</a></li>
<li class="chapter" data-level="2.2.2" data-path="vis-basics.html"><a href="vis-basics.html#combining-geoms"><i class="fa fa-check"></i><b>2.2.2</b> Combining geoms</a></li>
<li class="chapter" data-level="2.2.3" data-path="vis-basics.html"><a href="vis-basics.html#summary"><i class="fa fa-check"></i><b>2.2.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="vis-basics.html"><a href="vis-basics.html#export-saving"><i class="fa fa-check"></i><b>2.3</b> Export &amp; saving</a><ul>
<li class="chapter" data-level="2.3.1" data-path="vis-basics.html"><a href="vis-basics.html#base-r-vs.-ggplot2"><i class="fa fa-check"></i><b>2.3.1</b> Base R vs. {{ggplot2}}</a></li>
<li class="chapter" data-level="2.3.2" data-path="vis-basics.html"><a href="vis-basics.html#storing-the-plot-as-an-r-object"><i class="fa fa-check"></i><b>2.3.2</b> Storing the plot as an R object</a></li>
<li class="chapter" data-level="2.3.3" data-path="vis-basics.html"><a href="vis-basics.html#best-practices-for-exporting"><i class="fa fa-check"></i><b>2.3.3</b> Best practices for exporting</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="vis-basics.html"><a href="vis-basics.html#two-variable-plots"><i class="fa fa-check"></i><b>2.4</b> Two variable plots</a><ul>
<li class="chapter" data-level="2.4.1" data-path="vis-basics.html"><a href="vis-basics.html#continuous-x-and-y"><i class="fa fa-check"></i><b>2.4.1</b> Continuous X and Y</a></li>
<li class="chapter" data-level="2.4.2" data-path="vis-basics.html"><a href="vis-basics.html#discrete-x-and-continuous-y"><i class="fa fa-check"></i><b>2.4.2</b> Discrete X and continuous Y</a></li>
<li class="chapter" data-level="2.4.3" data-path="vis-basics.html"><a href="vis-basics.html#discrete-x-and-y"><i class="fa fa-check"></i><b>2.4.3</b> Discrete X and Y</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="vis-basics.html"><a href="vis-basics.html#one-variable-plots"><i class="fa fa-check"></i><b>2.5</b> One variable plots</a><ul>
<li class="chapter" data-level="2.5.1" data-path="vis-basics.html"><a href="vis-basics.html#continuous-variables"><i class="fa fa-check"></i><b>2.5.1</b> Continuous variables</a></li>
<li class="chapter" data-level="2.5.2" data-path="vis-basics.html"><a href="vis-basics.html#discrete-variables"><i class="fa fa-check"></i><b>2.5.2</b> Discrete variables</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="vis-basics.html"><a href="vis-basics.html#colors-and-shape"><i class="fa fa-check"></i><b>2.6</b> Colors and shape</a><ul>
<li class="chapter" data-level="2.6.1" data-path="vis-basics.html"><a href="vis-basics.html#static-colors"><i class="fa fa-check"></i><b>2.6.1</b> Static colors</a></li>
<li class="chapter" data-level="2.6.2" data-path="vis-basics.html"><a href="vis-basics.html#dynamic-colors"><i class="fa fa-check"></i><b>2.6.2</b> Dynamic colors</a></li>
<li class="chapter" data-level="2.6.3" data-path="vis-basics.html"><a href="vis-basics.html#shape"><i class="fa fa-check"></i><b>2.6.3</b> Shape</a></li>
<li class="chapter" data-level="2.6.4" data-path="vis-basics.html"><a href="vis-basics.html#combining-color-and-shape"><i class="fa fa-check"></i><b>2.6.4</b> Combining color and shape</a></li>
<li class="chapter" data-level="2.6.5" data-path="vis-basics.html"><a href="vis-basics.html#transparency"><i class="fa fa-check"></i><b>2.6.5</b> Transparency</a></li>
<li class="chapter" data-level="2.6.6" data-path="vis-basics.html"><a href="vis-basics.html#what-can-go-wrong"><i class="fa fa-check"></i><b>2.6.6</b> What can go wrong</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="vis-basics.html"><a href="vis-basics.html#labels"><i class="fa fa-check"></i><b>2.7</b> Labels</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vis-adv.html"><a href="vis-adv.html"><i class="fa fa-check"></i><b>3</b> {ggplot2} advanced</a><ul>
<li class="chapter" data-level="3.1" data-path="vis-adv.html"><a href="vis-adv.html#extensions"><i class="fa fa-check"></i><b>3.1</b> Extensions</a><ul>
<li class="chapter" data-level="3.1.1" data-path="vis-adv.html"><a href="vis-adv.html#ggsci"><i class="fa fa-check"></i><b>3.1.1</b> {ggsci}</a></li>
<li class="chapter" data-level="3.1.2" data-path="vis-adv.html"><a href="vis-adv.html#ggforce"><i class="fa fa-check"></i><b>3.1.2</b> {ggforce}</a></li>
<li class="chapter" data-level="3.1.3" data-path="vis-adv.html"><a href="vis-adv.html#gganimate-1"><i class="fa fa-check"></i><b>3.1.3</b> {gganimate}</a></li>
<li class="chapter" data-level="3.1.4" data-path="vis-adv.html"><a href="vis-adv.html#ggtext"><i class="fa fa-check"></i><b>3.1.4</b> {ggtext}</a></li>
<li class="chapter" data-level="3.1.5" data-path="vis-adv.html"><a href="vis-adv.html#ggrepel"><i class="fa fa-check"></i><b>3.1.5</b> {ggrepel}</a></li>
<li class="chapter" data-level="3.1.6" data-path="vis-adv.html"><a href="vis-adv.html#ggiraph"><i class="fa fa-check"></i><b>3.1.6</b> {ggiraph}</a></li>
<li class="chapter" data-level="3.1.7" data-path="vis-adv.html"><a href="vis-adv.html#ggbeeswarm"><i class="fa fa-check"></i><b>3.1.7</b> {ggbeeswarm}</a></li>
<li class="chapter" data-level="3.1.8" data-path="vis-adv.html"><a href="vis-adv.html#ggpmisc"><i class="fa fa-check"></i><b>3.1.8</b> {ggpmisc}</a></li>
<li class="chapter" data-level="3.1.9" data-path="vis-adv.html"><a href="vis-adv.html#esquisse"><i class="fa fa-check"></i><b>3.1.9</b> {esquisse}</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Tidying, transforming and importing</b></span></li>
<li class="chapter" data-level="4" data-path="transformation.html"><a href="transformation.html"><i class="fa fa-check"></i><b>4</b> Transformation</a><ul>
<li class="chapter" data-level="4.1" data-path="transformation.html"><a href="transformation.html#package-conflicted"><i class="fa fa-check"></i><b>4.1</b> Package: {conflicted}</a></li>
<li class="chapter" data-level="4.2" data-path="transformation.html"><a href="transformation.html#filtering-dplyrfilter"><i class="fa fa-check"></i><b>4.2</b> Filtering: <code>dplyr::filter()</code></a></li>
<li class="chapter" data-level="4.3" data-path="transformation.html"><a href="transformation.html#sort-rows-dplyrarrange"><i class="fa fa-check"></i><b>4.3</b> Sort rows: <code>dplyr::arrange()</code></a></li>
<li class="chapter" data-level="4.4" data-path="transformation.html"><a href="transformation.html#the-pipe"><i class="fa fa-check"></i><b>4.4</b> The pipe</a><ul>
<li class="chapter" data-level="4.4.1" data-path="transformation.html"><a href="transformation.html#further-advantages"><i class="fa fa-check"></i><b>4.4.1</b> Further advantages</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="transformation.html"><a href="transformation.html#pick-columns-dplyrselect"><i class="fa fa-check"></i><b>4.5</b> Pick columns: <code>dplyr::select()</code></a></li>
<li class="chapter" data-level="4.6" data-path="transformation.html"><a href="transformation.html#create-new-columns-based-on-old-ones-dplyrmutate"><i class="fa fa-check"></i><b>4.6</b> Create new columns based on old ones: <code>dplyr::mutate()</code></a></li>
<li class="chapter" data-level="4.7" data-path="transformation.html"><a href="transformation.html#summarize-data-by-groups-dplyrsummarize-dplyrgroup_by-dplyrungroup"><i class="fa fa-check"></i><b>4.7</b> Summarize data (by groups): <code>dplyr::summarize()</code>, <code>dplyr::group_by()</code> + <code>dplyr::ungroup()</code></a></li>
<li class="chapter" data-level="4.8" data-path="transformation.html"><a href="transformation.html#summary-plots"><i class="fa fa-check"></i><b>4.8</b> Summary-plots</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>5</b> Import</a><ul>
<li class="chapter" data-level="5.1" data-path="import.html"><a href="import.html#section"><i class="fa fa-check"></i><b>5.1</b> <No caption defined></a></li>
<li class="chapter" data-level="5.2" data-path="import.html"><a href="import.html#import-many-files"><i class="fa fa-check"></i><b>5.2</b> Import many files</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tidying.html"><a href="tidying.html"><i class="fa fa-check"></i><b>6</b> Tidying</a><ul>
<li class="chapter" data-level="6.1" data-path="tidying.html"><a href="tidying.html#pivoting"><i class="fa fa-check"></i><b>6.1</b> Pivoting</a><ul>
<li class="chapter" data-level="6.1.1" data-path="tidying.html"><a href="tidying.html#convert-to-longer-form"><i class="fa fa-check"></i><b>6.1.1</b> Convert to longer form</a></li>
<li class="chapter" data-level="6.1.2" data-path="tidying.html"><a href="tidying.html#convert-to-wider-form"><i class="fa fa-check"></i><b>6.1.2</b> Convert to wider form</a></li>
<li class="chapter" data-level="6.1.3" data-path="tidying.html"><a href="tidying.html#use-cases"><i class="fa fa-check"></i><b>6.1.3</b> Use cases</a></li>
<li class="chapter" data-level="6.1.4" data-path="tidying.html"><a href="tidying.html#combining-vertically"><i class="fa fa-check"></i><b>6.1.4</b> Combining vertically</a></li>
<li class="chapter" data-level="6.1.5" data-path="tidying.html"><a href="tidying.html#tidy-data"><i class="fa fa-check"></i><b>6.1.5</b> Tidy data</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="tidying.html"><a href="tidying.html#separating-and-uniting"><i class="fa fa-check"></i><b>6.2</b> Separating and uniting</a><ul>
<li class="chapter" data-level="6.2.1" data-path="tidying.html"><a href="tidying.html#parsing-numbers"><i class="fa fa-check"></i><b>6.2.1</b> Parsing numbers</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="tidying.html"><a href="tidying.html#section-1"><i class="fa fa-check"></i><b>6.3</b> <No caption defined></a></li>
</ul></li>
<li class="part"><span><b>III Reporting</b></span></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="7" data-path="best-practices.html"><a href="best-practices.html"><i class="fa fa-check"></i><b>7</b> Best practices</a><ul>
<li class="chapter" data-level="7.1" data-path="best-practices.html"><a href="best-practices.html#description"><i class="fa fa-check"></i><b>7.1</b> DESCRIPTION</a></li>
<li class="chapter" data-level="7.2" data-path="best-practices.html"><a href="best-practices.html#r"><i class="fa fa-check"></i><b>7.2</b> R</a></li>
<li class="chapter" data-level="7.3" data-path="best-practices.html"><a href="best-practices.html#roxygen2"><i class="fa fa-check"></i><b>7.3</b> roxygen2</a></li>
<li class="chapter" data-level="7.4" data-path="best-practices.html"><a href="best-practices.html#testthat"><i class="fa fa-check"></i><b>7.4</b> testthat</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualization, transformation and reporting with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidying" class="section level1">
<h1><span class="header-section-number">6</span> Tidying</h1>
<blockquote>
<p>Rows, columns, cells.</p>
</blockquote>
<p>This chapter discusses pivoting and data tidying with the help of the <a href="https://tidyr.tidyverse.org/">tidyr</a> package.</p>
<div id="pivoting" class="section level2">
<h2><span class="header-section-number">6.1</span> Pivoting</h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb223-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb223-3" data-line-number="3"></a>
<a class="sourceLine" id="cb223-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb223-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1"><span class="kw">conflict_prefer</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
</details>
<p>Pivoting describes operations that help rearrange data in different ways.
The following two tables contain the same data arranged differently.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1">table1</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span>  </span><span style='font-weight: bold;'>cases</span><span> </span><span style='font-weight: bold;'>population</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999    745   19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000   </span><span style='text-decoration: underline;'>2</span><span>666   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>3</span><span> Brazil       </span><span style='text-decoration: underline;'>1</span><span>999  </span><span style='text-decoration: underline;'>37</span><span>737  172</span><span style='text-decoration: underline;'>006</span><span>362
## </span><span style='color: #555555;'>4</span><span> Brazil       </span><span style='text-decoration: underline;'>2</span><span>000  </span><span style='text-decoration: underline;'>80</span><span>488  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>5</span><span> China        </span><span style='text-decoration: underline;'>1</span><span>999 </span><span style='text-decoration: underline;'>212</span><span>258 </span><span style='text-decoration: underline;'>1</span><span>272</span><span style='text-decoration: underline;'>915</span><span>272
## </span><span style='color: #555555;'>6</span><span> China        </span><span style='text-decoration: underline;'>2</span><span>000 </span><span style='text-decoration: underline;'>213</span><span>766 </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">table2</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 12 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>type</span><span>          </span><span style='font-weight: bold;'>count</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 cases           745
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 population 19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>3</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000 cases          </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'># … with 9 more rows</span><span>
</span></CODE></PRE>
<p>Both tables contain <code>country</code> and <code>year</code> column that describe the source of the measurements.
The “wider” version, <code>table1</code>, contains two columns that hold the number of cases (of a disease) and the population for the corresponding country in the corresponding year.
In the “longer” version, <code>table2</code>, the number of cases and the population are stored in the same <code>count</code> column, with the <code>type</code> column defining the measurement.</p>
<p>Somewhat counter-intuitively, “longer-form” data is often better suited for analyzing data.
“Wider-form” data makes better use of screen space, but may be more difficult to work with.</p>
<p>The following example computes the maximum number of cases and population for each country.
For the wider form, this requires repeating the same expression for all columns.
This may work with two columns but becomes tedious once more measurements are added.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb231-4" data-line-number="4">    <span class="dt">max_cases =</span> <span class="kw">max</span>(cases),</a>
<a class="sourceLine" id="cb231-5" data-line-number="5">    <span class="dt">max_population =</span> <span class="kw">max</span>(population)</a>
<a class="sourceLine" id="cb231-6" data-line-number="6">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb231-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 3 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>     </span><span style='font-weight: bold;'>max_cases</span><span> </span><span style='font-weight: bold;'>max_population</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>           </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan      </span><span style='text-decoration: underline;'>2</span><span>666       20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>2</span><span> Brazil          </span><span style='text-decoration: underline;'>80</span><span>488      174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>3</span><span> China          </span><span style='text-decoration: underline;'>213</span><span>766     </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<p>The <code>_at</code> family of functions helps iterating over columns, but all columns still need to be enumerated.
(Specifying ranges of columns is rather brittle.)</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize_at</span>(</a>
<a class="sourceLine" id="cb232-4" data-line-number="4">    <span class="kw">vars</span>(cases, population),</a>
<a class="sourceLine" id="cb232-5" data-line-number="5">    max</a>
<a class="sourceLine" id="cb232-6" data-line-number="6">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 3 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>cases</span><span> </span><span style='font-weight: bold;'>population</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan   </span><span style='text-decoration: underline;'>2</span><span>666   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>2</span><span> Brazil       </span><span style='text-decoration: underline;'>80</span><span>488  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>3</span><span> China       </span><span style='text-decoration: underline;'>213</span><span>766 </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<p>If the data is in the “longer” form, it is sufficient to include <code>type</code> in the grouping variables.
The same code works for arbitrary number of measurements.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1">table2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb233-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb233-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb233-4" data-line-number="4">    <span class="dt">max =</span> <span class="kw">max</span>(count)</a>
<a class="sourceLine" id="cb233-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb233-6" data-line-number="6"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>     </span><span style='font-weight: bold;'>type</span><span>              </span><span style='font-weight: bold;'>max</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>           </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan cases            </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'>2</span><span> Afghanistan population   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>3</span><span> Brazil      cases           </span><span style='text-decoration: underline;'>80</span><span>488
## </span><span style='color: #555555;'>4</span><span> Brazil      population  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>5</span><span> China       cases          </span><span style='text-decoration: underline;'>213</span><span>766
## </span><span style='color: #555555;'>6</span><span> China       population </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<p>The following examples give a gentle introduction into pivoting.</p>
<div id="convert-to-longer-form" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Convert to longer form</h3>
<p>The <code>pivot_longer()</code> function takes a “wider-form” dataset and converts it to an equivalent dataset with more rows.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1">table1</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span>  </span><span style='font-weight: bold;'>cases</span><span> </span><span style='font-weight: bold;'>population</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999    745   19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000   </span><span style='text-decoration: underline;'>2</span><span>666   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>3</span><span> Brazil       </span><span style='text-decoration: underline;'>1</span><span>999  </span><span style='text-decoration: underline;'>37</span><span>737  172</span><span style='text-decoration: underline;'>006</span><span>362
## </span><span style='color: #555555;'>4</span><span> Brazil       </span><span style='text-decoration: underline;'>2</span><span>000  </span><span style='text-decoration: underline;'>80</span><span>488  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>5</span><span> China        </span><span style='text-decoration: underline;'>1</span><span>999 </span><span style='text-decoration: underline;'>212</span><span>258 </span><span style='text-decoration: underline;'>1</span><span>272</span><span style='text-decoration: underline;'>915</span><span>272
## </span><span style='color: #555555;'>6</span><span> China        </span><span style='text-decoration: underline;'>2</span><span>000 </span><span style='text-decoration: underline;'>213</span><span>766 </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(country, year))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 12 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>name</span><span>          </span><span style='font-weight: bold;'>value</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 cases           745
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 population 19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>3</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000 cases          </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'># … with 9 more rows</span><span>
</span></CODE></PRE>
<p>The <code>-c(...)</code> notation indicates that all column except <code>country</code> and <code>year</code> are to be transformed into longer form.
The column names become the contents of the new <code>name</code> column, the values are available in the <code>value</code> column.</p>
<p>The result of this operation isn’t strictly equivalent to <code>table2</code>, we need to rename and sort differently.
Alternatively, the <code>names_to</code> and <code>values_to</code> arguments allow specifying the names of the new columns.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(country, year)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-3" data-line-number="3"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">type =</span> name, <span class="dt">count =</span> value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(country, year, type)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 12 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>type</span><span>          </span><span style='font-weight: bold;'>count</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 cases           745
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 population 19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>3</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000 cases          </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'># … with 9 more rows</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb237-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb237-3" data-line-number="3">    <span class="op">-</span><span class="kw">c</span>(country, year),</a>
<a class="sourceLine" id="cb237-4" data-line-number="4">    <span class="dt">names_to =</span> <span class="st">&quot;type&quot;</span>,</a>
<a class="sourceLine" id="cb237-5" data-line-number="5">    <span class="dt">values_to =</span> <span class="st">&quot;count&quot;</span></a>
<a class="sourceLine" id="cb237-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb237-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(country, year, type)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 12 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>type</span><span>          </span><span style='font-weight: bold;'>count</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 cases           745
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 population 19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>3</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000 cases          </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'># … with 9 more rows</span><span>
</span></CODE></PRE>
</div>
<div id="convert-to-wider-form" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Convert to wider form</h3>
<p>The <code>pivot_wider()</code> form does the inverse: it creates a dataset with fewer rows.
If the <code>name</code> and <code>value</code> columns are named differently, these columns can be provided via the <code>names_from</code> and <code>values_from</code> arguments.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">table2</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 12 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>type</span><span>          </span><span style='font-weight: bold;'>count</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 cases           745
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 population 19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>3</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000 cases          </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'># … with 9 more rows</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1">table2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> type, <span class="dt">values_from =</span> count)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span>  </span><span style='font-weight: bold;'>cases</span><span> </span><span style='font-weight: bold;'>population</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999    745   19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000   </span><span style='text-decoration: underline;'>2</span><span>666   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>3</span><span> Brazil       </span><span style='text-decoration: underline;'>1</span><span>999  </span><span style='text-decoration: underline;'>37</span><span>737  172</span><span style='text-decoration: underline;'>006</span><span>362
## </span><span style='color: #555555;'>4</span><span> Brazil       </span><span style='text-decoration: underline;'>2</span><span>000  </span><span style='text-decoration: underline;'>80</span><span>488  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>5</span><span> China        </span><span style='text-decoration: underline;'>1</span><span>999 </span><span style='text-decoration: underline;'>212</span><span>258 </span><span style='text-decoration: underline;'>1</span><span>272</span><span style='text-decoration: underline;'>915</span><span>272
## </span><span style='color: #555555;'>6</span><span> China        </span><span style='text-decoration: underline;'>2</span><span>000 </span><span style='text-decoration: underline;'>213</span><span>766 </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">table2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb240-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">name =</span> type, <span class="dt">value =</span> count) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb240-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_wider</span>()</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span>  </span><span style='font-weight: bold;'>cases</span><span> </span><span style='font-weight: bold;'>population</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999    745   19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000   </span><span style='text-decoration: underline;'>2</span><span>666   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>3</span><span> Brazil       </span><span style='text-decoration: underline;'>1</span><span>999  </span><span style='text-decoration: underline;'>37</span><span>737  172</span><span style='text-decoration: underline;'>006</span><span>362
## </span><span style='color: #555555;'>4</span><span> Brazil       </span><span style='text-decoration: underline;'>2</span><span>000  </span><span style='text-decoration: underline;'>80</span><span>488  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>5</span><span> China        </span><span style='text-decoration: underline;'>1</span><span>999 </span><span style='text-decoration: underline;'>212</span><span>258 </span><span style='text-decoration: underline;'>1</span><span>272</span><span style='text-decoration: underline;'>915</span><span>272
## </span><span style='color: #555555;'>6</span><span> China        </span><span style='text-decoration: underline;'>2</span><span>000 </span><span style='text-decoration: underline;'>213</span><span>766 </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
</div>
<div id="use-cases" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Use cases</h3>
<p>Data in “longer” form usually works better for plotting the values side by side, e.g. by assigning the type of value to an aesthetic.
Recall that each row in the data produces one geometric object in the corresponding layer.
For a bar chart that shows cases and population side by side, mapped to the <code>y</code> aesthetic, the “longer” form is more natural.</p>
<ul>
<li><code>table2</code> form requires only one layer, the fill color is determined automatically, the legend is created automatically</li>
<li><code>table1</code> requires two layers, manual assignment of fill color, and manual creation of legend (not shown)</li>
</ul>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">table2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb241-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb241-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(country, count, <span class="dt">fill =</span> type), <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb241-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year) <span class="op">+</span></a>
<a class="sourceLine" id="cb241-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_log10</span>()</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/41-longer-form-more-useful-for-plotting-all-values-side-by-side-1.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb242-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(country, population), <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(country, cases), <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-5" data-line-number="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year) <span class="op">+</span></a>
<a class="sourceLine" id="cb242-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_log10</span>()</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/41-longer-form-more-useful-for-plotting-all-values-side-by-side-2.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<p>On the other hand, iIf only a single measurement needs to be plotted, the “wider” form is easier to work with.</p>
<ul>
<li><code>table1</code> only requires selecting the correct column</li>
<li><code>table2</code> requires a <code>filter()</code></li>
</ul>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb243-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb243-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(country, cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb243-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year)</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/41-wider-form-more-useful-for-plotting-a-single-value-1.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">table2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb244-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(country, count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb244-5" data-line-number="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year)</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/41-wider-form-more-useful-for-plotting-a-single-value-2.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<p>The “wider” form is also the only way to map different measures to different aesthetics, e.g. to correlate values.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb245-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb245-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(cases, population, <span class="dt">color =</span> <span class="kw">factor</span>(year), <span class="dt">shape =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb245-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_log10</span>()</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/41-wider-form-the-only-way-to-correlate-values-1.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
</div>
<div id="combining-vertically" class="section level3">
<h3><span class="header-section-number">6.1.4</span> Combining vertically</h3>
<p>A different view on the same data is given in the two tables <code>table4a</code> and <code>table4b</code>.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">table4a</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 3 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>     </span><span style='font-weight: bold;'>`1999`</span><span> </span><span style='font-weight: bold;'>`2000`</span><span>
## </span><span style='color: #555555;'>*</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan    745   </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'>2</span><span> Brazil       </span><span style='text-decoration: underline;'>37</span><span>737  </span><span style='text-decoration: underline;'>80</span><span>488
## </span><span style='color: #555555;'>3</span><span> China       </span><span style='text-decoration: underline;'>212</span><span>258 </span><span style='text-decoration: underline;'>213</span><span>766
</span></CODE></PRE>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" data-line-number="1">table4b</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 3 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>         </span><span style='font-weight: bold;'>`1999`</span><span>     </span><span style='font-weight: bold;'>`2000`</span><span>
## </span><span style='color: #555555;'>*</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan   19</span><span style='text-decoration: underline;'>987</span><span>071   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>2</span><span> Brazil       172</span><span style='text-decoration: underline;'>006</span><span>362  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>3</span><span> China       </span><span style='text-decoration: underline;'>1</span><span>272</span><span style='text-decoration: underline;'>915</span><span>272 </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<p>The <code>bind_rows()</code> function combines these two parts into a single table.
The <code>.id = &quot;type&quot;</code> setting ensures that the input datasets gain different tags in the new <code>type</code> column.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1">table4 &lt;-</a>
<a class="sourceLine" id="cb248-2" data-line-number="2"><span class="st">  </span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb248-3" data-line-number="3">    <span class="dt">cases =</span> table4a,</a>
<a class="sourceLine" id="cb248-4" data-line-number="4">    <span class="dt">population =</span> table4b,</a>
<a class="sourceLine" id="cb248-5" data-line-number="5">    <span class="dt">.id =</span> <span class="st">&quot;type&quot;</span></a>
<a class="sourceLine" id="cb248-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb248-7" data-line-number="7">table4</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 4</span><span>
##   </span><span style='font-weight: bold;'>type</span><span>       </span><span style='font-weight: bold;'>country</span><span>         </span><span style='font-weight: bold;'>`1999`</span><span>     </span><span style='font-weight: bold;'>`2000`</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> cases      Afghanistan        745       </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'>2</span><span> cases      Brazil           </span><span style='text-decoration: underline;'>37</span><span>737      </span><span style='text-decoration: underline;'>80</span><span>488
## </span><span style='color: #555555;'>3</span><span> cases      China           </span><span style='text-decoration: underline;'>212</span><span>258     </span><span style='text-decoration: underline;'>213</span><span>766
## </span><span style='color: #555555;'>4</span><span> population Afghanistan   19</span><span style='text-decoration: underline;'>987</span><span>071   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>5</span><span> population Brazil       172</span><span style='text-decoration: underline;'>006</span><span>362  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>6</span><span> population China       </span><span style='text-decoration: underline;'>1</span><span>272</span><span style='text-decoration: underline;'>915</span><span>272 </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<p>As before, <code>pivot_longer()</code> helps converting the results into something similar to <code>table2</code>.
The result isn’t quite the same yet, can you spot the difference?</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1">table4 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb249-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">c</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 12 x 4</span><span>
##   </span><span style='font-weight: bold;'>type</span><span>  </span><span style='font-weight: bold;'>country</span><span>     </span><span style='font-weight: bold;'>name</span><span>  </span><span style='font-weight: bold;'>value</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> cases Afghanistan 1999    745
## </span><span style='color: #555555;'>2</span><span> cases Afghanistan 2000   </span><span style='text-decoration: underline;'>2</span><span>666
## </span><span style='color: #555555;'>3</span><span> cases Brazil      1999  </span><span style='text-decoration: underline;'>37</span><span>737
## </span><span style='color: #555555;'># … with 9 more rows</span><span>
</span></CODE></PRE>
</div>
<div id="tidy-data" class="section level3">
<h3><span class="header-section-number">6.1.5</span> Tidy data</h3>
<p>From “R for data science”:</p>
<blockquote>
<p>In a tidy dataset,</p>
<ol style="list-style-type: decimal">
<li>each variable must have its own column.</li>
<li>each observation must have its own row.</li>
<li>each value must have its own cell.</li>
</ol>
</blockquote>
<div class="figure">
<img src="img/tidy-1.png" alt="Tidy data" />
<p class="caption">Tidy data</p>
</div>
<p>The following example shows a case that violates the first two rules: WHO data arranged for optimal use of screen space.
The column names define, in addition to the measurement type <code>new_sp</code>, <code>new_sn</code>, <code>new_ep</code> and <code>newrel</code>, the age and sex stratum of the corresponding measurements.
One single <code>pivot_longer()</code> call transforms the data into a longer-form version with four measurement columns and one row for each age/sex stratum.
The <code>names_pattern</code> is a regular expression that defines what part of the column name is stored where.
(<a href="https://en.wikipedia.org/wiki/Regular_expression">Regular expressions</a> are a powerful tool for parsing text data, out of scope for this lecture but very much worth looking into.)
The <code>names_to</code> sequence defines, for each <code>()</code> group in <code>names_pattern</code>, if the data encoded in the column name is stored in a new column or if it is kept as column name.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">who <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-2" data-line-number="2"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 7,240 x 60</span><span>
##   </span><span style='font-weight: bold;'>country</span><span> </span><span style='font-weight: bold;'>iso2</span><span>  </span><span style='font-weight: bold;'>iso3</span><span>   </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>new_sp_m014</span><span> </span><span style='font-weight: bold;'>new_sp_m1524</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghan… AF    AFG    </span><span style='text-decoration: underline;'>1</span><span>980          </span><span style='color: #BB0000;'>NA</span><span>           </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'>2</span><span> Afghan… AF    AFG    </span><span style='text-decoration: underline;'>1</span><span>981          </span><span style='color: #BB0000;'>NA</span><span>           </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'>3</span><span> Afghan… AF    AFG    </span><span style='text-decoration: underline;'>1</span><span>982          </span><span style='color: #BB0000;'>NA</span><span>           </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'># … with 7,237 more rows, and 54 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>new_sp_m2534</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sp_m3544</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sp_m4554</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sp_m5564</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sp_m65</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sp_f014</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sp_f1524</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sp_f2534</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sp_f3544</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sp_f4554</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sp_f5564</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sp_f65</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sn_m014</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sn_m1524</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sn_m2534</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sn_m3544</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sn_m4554</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sn_m5564</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sn_m65</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sn_f014</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sn_f1524</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sn_f2534</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sn_f3544</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_sn_f4554</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sn_f5564</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_sn_f65</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_ep_m014</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_ep_m1524</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_ep_m2534</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_ep_m3544</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_ep_m4554</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_ep_m5564</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_ep_m65</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_ep_f014</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_ep_f1524</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_ep_f2534</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_ep_f3544</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>new_ep_f4554</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_ep_f5564</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>new_ep_f65</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>newrel_m014</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>newrel_m1524</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>newrel_m2534</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>newrel_m3544</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>newrel_m4554</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>newrel_m5564</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>newrel_m65</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>newrel_f014</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>newrel_f1524</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>newrel_f2534</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>newrel_f3544</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>newrel_f4554</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>newrel_f5564</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>newrel_f65</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1">who_longer &lt;-</a>
<a class="sourceLine" id="cb251-2" data-line-number="2"><span class="st">  </span>who <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb251-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb251-4" data-line-number="4">    <span class="op">-</span>(country<span class="op">:</span>year),</a>
<a class="sourceLine" id="cb251-5" data-line-number="5">    <span class="dt">names_pattern =</span> <span class="st">&quot;([a-z_]+)_(.)([0-9]+)&quot;</span>,</a>
<a class="sourceLine" id="cb251-6" data-line-number="6">    <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>)</a>
<a class="sourceLine" id="cb251-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb251-8" data-line-number="8"></a>
<a class="sourceLine" id="cb251-9" data-line-number="9">who_longer</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 101,360 x 10</span><span>
##   </span><span style='font-weight: bold;'>country</span><span> </span><span style='font-weight: bold;'>iso2</span><span>  </span><span style='font-weight: bold;'>iso3</span><span>   </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>sex</span><span>   </span><span style='font-weight: bold;'>age</span><span>   </span><span style='font-weight: bold;'>new_sp</span><span> </span><span style='font-weight: bold;'>new_sn</span><span> </span><span style='font-weight: bold;'>new_ep</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghan… AF    AFG    </span><span style='text-decoration: underline;'>1</span><span>980 m     014       </span><span style='color: #BB0000;'>NA</span><span>     </span><span style='color: #BB0000;'>NA</span><span>     </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'>2</span><span> Afghan… AF    AFG    </span><span style='text-decoration: underline;'>1</span><span>980 m     1524      </span><span style='color: #BB0000;'>NA</span><span>     </span><span style='color: #BB0000;'>NA</span><span>     </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'>3</span><span> Afghan… AF    AFG    </span><span style='text-decoration: underline;'>1</span><span>980 m     2534      </span><span style='color: #BB0000;'>NA</span><span>     </span><span style='color: #BB0000;'>NA</span><span>     </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'># … with 1.014e+05 more rows, and 1 more variable:
## #   </span><span style='color: #555555;font-weight: bold;'>newrel</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" data-line-number="1">who_longer <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb252-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(sex, age)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 14 x 3</span><span>
##   </span><span style='font-weight: bold;'>sex</span><span>   </span><span style='font-weight: bold;'>age</span><span>       </span><span style='font-weight: bold;'>n</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> f     014    </span><span style='text-decoration: underline;'>7</span><span>240
## </span><span style='color: #555555;'>2</span><span> f     1524   </span><span style='text-decoration: underline;'>7</span><span>240
## </span><span style='color: #555555;'>3</span><span> f     2534   </span><span style='text-decoration: underline;'>7</span><span>240
## </span><span style='color: #555555;'># … with 11 more rows</span><span>
</span></CODE></PRE>
</div>
</div>
<div id="separating-and-uniting" class="section level2">
<h2><span class="header-section-number">6.2</span> Separating and uniting</h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb253-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb253-3" data-line-number="3"></a>
<a class="sourceLine" id="cb253-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb253-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1"><span class="kw">conflict_prefer</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
</details>
<p>The <code>table3</code> table violates the third principle of tidy data: each cell contains two values.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">table3</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>rate</span><span>             
## </span><span style='color: #555555;'>*</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 745/19987071     
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000 2666/20595360    
## </span><span style='color: #555555;'>3</span><span> Brazil       </span><span style='text-decoration: underline;'>1</span><span>999 37737/172006362  
## </span><span style='color: #555555;'>4</span><span> Brazil       </span><span style='text-decoration: underline;'>2</span><span>000 80488/174504898  
## </span><span style='color: #555555;'>5</span><span> China        </span><span style='text-decoration: underline;'>1</span><span>999 212258/1272915272
## </span><span style='color: #555555;'>6</span><span> China        </span><span style='text-decoration: underline;'>2</span><span>000 213766/1280428583
</span></CODE></PRE>
<p>The <code>separate()</code> verb offers a convenient way to deal with this situation, including automatic type conversion.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" data-line-number="1">table3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(rate, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>cases</span><span>  </span><span style='font-weight: bold;'>population</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 745    19987071  
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000 2666   20595360  
## </span><span style='color: #555555;'>3</span><span> Brazil       </span><span style='text-decoration: underline;'>1</span><span>999 37737  172006362 
## </span><span style='color: #555555;'>4</span><span> Brazil       </span><span style='text-decoration: underline;'>2</span><span>000 80488  174504898 
## </span><span style='color: #555555;'>5</span><span> China        </span><span style='text-decoration: underline;'>1</span><span>999 212258 1272915272
## </span><span style='color: #555555;'>6</span><span> China        </span><span style='text-decoration: underline;'>2</span><span>000 213766 1280428583
</span></CODE></PRE>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1">table3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb261-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(rate, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>, <span class="dt">convert =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span>  </span><span style='font-weight: bold;'>cases</span><span> </span><span style='font-weight: bold;'>population</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999    745   19</span><span style='text-decoration: underline;'>987</span><span>071
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000   </span><span style='text-decoration: underline;'>2</span><span>666   20</span><span style='text-decoration: underline;'>595</span><span>360
## </span><span style='color: #555555;'>3</span><span> Brazil       </span><span style='text-decoration: underline;'>1</span><span>999  </span><span style='text-decoration: underline;'>37</span><span>737  172</span><span style='text-decoration: underline;'>006</span><span>362
## </span><span style='color: #555555;'>4</span><span> Brazil       </span><span style='text-decoration: underline;'>2</span><span>000  </span><span style='text-decoration: underline;'>80</span><span>488  174</span><span style='text-decoration: underline;'>504</span><span>898
## </span><span style='color: #555555;'>5</span><span> China        </span><span style='text-decoration: underline;'>1</span><span>999 </span><span style='text-decoration: underline;'>212</span><span>258 </span><span style='text-decoration: underline;'>1</span><span>272</span><span style='text-decoration: underline;'>915</span><span>272
## </span><span style='color: #555555;'>6</span><span> China        </span><span style='text-decoration: underline;'>2</span><span>000 </span><span style='text-decoration: underline;'>213</span><span>766 </span><span style='text-decoration: underline;'>1</span><span>280</span><span style='text-decoration: underline;'>428</span><span>583
</span></CODE></PRE>
<p>The inverse is offered by <code>unite()</code>.
The data in <code>table5</code> stores year data in two columns.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1">table5</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 4</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>     </span><span style='font-weight: bold;'>century</span><span> </span><span style='font-weight: bold;'>year</span><span>  </span><span style='font-weight: bold;'>rate</span><span>             
## </span><span style='color: #555555;'>*</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> Afghanistan 19      99    745/19987071     
## </span><span style='color: #555555;'>2</span><span> Afghanistan 20      00    2666/20595360    
## </span><span style='color: #555555;'>3</span><span> Brazil      19      99    37737/172006362  
## </span><span style='color: #555555;'>4</span><span> Brazil      20      00    80488/174504898  
## </span><span style='color: #555555;'>5</span><span> China       19      99    212258/1272915272
## </span><span style='color: #555555;'>6</span><span> China       20      00    213766/1280428583
</span></CODE></PRE>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1">table5 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb263-2" data-line-number="2"><span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;year&quot;</span>, <span class="kw">c</span>(century, year))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>     </span><span style='font-weight: bold;'>year</span><span>  </span><span style='font-weight: bold;'>rate</span><span>             
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> Afghanistan 19_99 745/19987071     
## </span><span style='color: #555555;'>2</span><span> Afghanistan 20_00 2666/20595360    
## </span><span style='color: #555555;'>3</span><span> Brazil      19_99 37737/172006362  
## </span><span style='color: #555555;'>4</span><span> Brazil      20_00 80488/174504898  
## </span><span style='color: #555555;'>5</span><span> China       19_99 212258/1272915272
## </span><span style='color: #555555;'>6</span><span> China       20_00 213766/1280428583
</span></CODE></PRE>
<p>The result needs a few tweaks to finally resemble <code>table3</code>.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1">table5 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb264-2" data-line-number="2"><span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;year&quot;</span>, <span class="kw">c</span>(century, year), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>     </span><span style='font-weight: bold;'>year</span><span>  </span><span style='font-weight: bold;'>rate</span><span>             
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> Afghanistan 1999  745/19987071     
## </span><span style='color: #555555;'>2</span><span> Afghanistan 2000  2666/20595360    
## </span><span style='color: #555555;'>3</span><span> Brazil      1999  37737/172006362  
## </span><span style='color: #555555;'>4</span><span> Brazil      2000  80488/174504898  
## </span><span style='color: #555555;'>5</span><span> China       1999  212258/1272915272
## </span><span style='color: #555555;'>6</span><span> China       2000  213766/1280428583
</span></CODE></PRE>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1">table5 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-2" data-line-number="2"><span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;year&quot;</span>, <span class="kw">c</span>(century, year), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.numeric</span>(year))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 6 x 3</span><span>
##   </span><span style='font-weight: bold;'>country</span><span>      </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>rate</span><span>             
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> Afghanistan  </span><span style='text-decoration: underline;'>1</span><span>999 745/19987071     
## </span><span style='color: #555555;'>2</span><span> Afghanistan  </span><span style='text-decoration: underline;'>2</span><span>000 2666/20595360    
## </span><span style='color: #555555;'>3</span><span> Brazil       </span><span style='text-decoration: underline;'>1</span><span>999 37737/172006362  
## </span><span style='color: #555555;'>4</span><span> Brazil       </span><span style='text-decoration: underline;'>2</span><span>000 80488/174504898  
## </span><span style='color: #555555;'>5</span><span> China        </span><span style='text-decoration: underline;'>1</span><span>999 212258/1272915272
## </span><span style='color: #555555;'>6</span><span> China        </span><span style='text-decoration: underline;'>2</span><span>000 213766/1280428583
</span></CODE></PRE>
<p>See the help for further details.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1">?separate</a>
<a class="sourceLine" id="cb266-2" data-line-number="2">?unite</a></code></pre></div>
<div id="parsing-numbers" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Parsing numbers</h3>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1">thousand_separator &lt;-</a>
<a class="sourceLine" id="cb267-2" data-line-number="2"><span class="st">  </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb267-3" data-line-number="3">    <span class="op">~</span>num,</a>
<a class="sourceLine" id="cb267-4" data-line-number="4">    <span class="st">&quot;1&#39;000.00&quot;</span>,</a>
<a class="sourceLine" id="cb267-5" data-line-number="5">    <span class="st">&quot;2&#39;000&#39;000.00&quot;</span></a>
<a class="sourceLine" id="cb267-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb267-7" data-line-number="7"></a>
<a class="sourceLine" id="cb267-8" data-line-number="8">thousand_separator</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 2 x 1</span><span>
##   </span><span style='font-weight: bold;'>num</span><span>         
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       
## </span><span style='color: #555555;'>1</span><span> 1'000.00    
## </span><span style='color: #555555;'>2</span><span> 2'000'000.00
</span></CODE></PRE>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1">thousand_separator <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb268-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(num, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;num&quot;</span>))</a></code></pre></div>
<pre><code>## Warning: Expected 1 pieces. Additional pieces discarded in 2
## rows [1, 2].</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 2 x 1</span><span>
##   </span><span style='font-weight: bold;'>num</span><span>  
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> 1    
## </span><span style='color: #555555;'>2</span><span> 2
</span></CODE></PRE>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1">thousand_separator <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">num =</span> <span class="kw">str_replace_all</span>(num, <span class="st">&quot;[^-0-9.]&quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">num =</span> <span class="kw">as.numeric</span>(num))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 2 x 1</span><span>
##       </span><span style='font-weight: bold;'>num</span><span>
##     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>    </span><span style='text-decoration: underline;'>1</span><span>000
## </span><span style='color: #555555;'>2</span><span> 2</span><span style='text-decoration: underline;'>000</span><span>000
</span></CODE></PRE>
</div>
</div>
<div id="section-1" class="section level2">
<h2><span class="header-section-number">6.3</span> <No caption defined></h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb271-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb271-3" data-line-number="3"></a>
<a class="sourceLine" id="cb271-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb271-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" data-line-number="1"><span class="kw">conflict_prefer</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1">table2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-2" data-line-number="2"><span class="st">  </span><span class="kw">xtabs</span>(count <span class="op">~</span><span class="st"> </span>., .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-3" data-line-number="3"><span class="st">  </span><span class="kw">ftable</span>()</a></code></pre></div>
<pre><code>##                  type      cases population
## country     year                           
## Afghanistan 1999             745   19987071
##             2000            2666   20595360
## Brazil      1999           37737  172006362
##             2000           80488  174504898
## China       1999          212258 1272915272
##             2000          213766 1280428583</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1">table2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-2" data-line-number="2"><span class="st">  </span><span class="kw">xtabs</span>(count <span class="op">~</span><span class="st"> </span>., .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-3" data-line-number="3"><span class="st">  </span><span class="kw">ftable</span>(<span class="dt">col.vars =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;type&quot;</span>))</a></code></pre></div>
<pre><code>##             year       1999                  2000           
##             type      cases population      cases population
## country                                                     
## Afghanistan             745   19987071       2666   20595360
## Brazil                37737  172006362      80488  174504898
## China                212258 1272915272     213766 1280428583</code></pre>
</details>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1">?<span class="st">`</span><span class="dt">tidyr-package</span><span class="st">`</span></a></code></pre></div>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1"><span class="ot">NA</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>

</div>
</div>



</div>



            </section>

          </div>
        </div>
      </div>
<a href="import.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="best-practices.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["vistransrep.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
