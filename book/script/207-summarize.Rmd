```{r 27-remove-all, include = FALSE}
rm(list = ls())
```


## Summarize data

<details><summary>*Click here to show setup code.*</summary>
```{r include = FALSE}
### Summarize data `dplyr::ungroup()`

```
```{r 27-setup-27-summarize-r}
library(tidyverse)
library(nycflights13)

library(conflicted)
conflict_prefer("filter", "dplyr")
conflict_prefer("lag", "dplyr")
```
</details>

Often we want to draw just conclusions from larger datasets by gaining insight by using statistical (or other) methods for summarizing -- and thus drastically reducing -- the data:
How much time did all planes spend in the air?

```{r include = FALSE}
# summary functions
```
```{r 27-summary-functions}
flights %>%
  select(air_time) %>%
  mutate(total_air_time = sum(air_time, na.rm = TRUE))
```

The `mutate()` call adds a new variable with the same value across all rows.
To reduce the result to a single row, use `summarize()`:

```{r include = FALSE}
# condense to one row with summarize
```
```{r 27-condense-to-one-row-with-summarize}
flights %>%
  summarize(total_air_time = sum(air_time, na.rm = TRUE))
```

The following functions compute summary values:

- `sum()`, `prod()`
    - `na.rm = TRUE`
- `mean()`, `median()`
- `sd()`, `IQR()`, `mad()`
- `min()`, `quantile(0.75)`, `max()`
- `sum()` and `mean()` for `logical` variables:
    ```r
    mean(is.na(arr_time))
    ```

## Ranking

- `n()`
- `first()`, `last()`, `nth()`


Simple counts can be computed with `n()` inside `summarize()`:

```{r include = FALSE}
# summarize with counts
```
```{r 27-summarize-with-counts}
flights %>%
  summarize(n = n())
```

A variety of aggregate functions is supported:

```{r include = FALSE}
# summarize with median
```
```{r 27-summarize-with-median}
flights %>%
  summarize(median = median(air_time, na.rm = TRUE))
```

It's possible to produce two different summarizations at once:

```{r include = FALSE}
# compute multiple summaries
```
```{r 27-compute-multiple-summaries}
flights %>%
  summarize(
    n = n(),
    mean_air_time = mean(air_time, na.rm = TRUE),
    median_air_time = median(air_time, na.rm = TRUE)
  )
```

The `summarize()` verb gains its full power in grouped operations.
Surround with `group_by()` and `ungroup()` to compute summaries in groups defined by common values in one or more columns.
In the next example, the same summary is computed separately for each origin airport.

```{r include = FALSE}
# Use group_by() and ungroup() to split data into groups
# ALWAYS use ungroup()
```
```{r 27-use-group-by-and-ungroup-to-split-data-into-groups}
flights %>%
  group_by(origin) %>%
  summarize(
    n = n(),
    mean_air_time = mean(air_time, na.rm = TRUE),
    median_air_time = median(air_time, na.rm = TRUE)
  ) %>%
  ungroup()
```

The next example splits the data into one group for each day.

```{r include = FALSE}
# Groups can be defined by more than one column
```
```{r 27-groups-can-be-defined-by-more-than-one-column}
flights %>%
  group_by(year, month, day) %>%
  summarize(
    n = n(),
    mean_air_time = mean(air_time, na.rm = TRUE),
    median_air_time = median(air_time, na.rm = TRUE)
  ) %>%
  ungroup()
```

For quick exploration, the names of the new columns can be omitted:

```{r include = FALSE}
# Anonymous summarize for a quick glance
# (column name is defined by the expression)
```
```{r 27-anonymous-summarize-for-a-quick-glance}
flights %>%
  group_by(year, month, day) %>%
  summarize(
    n(),
    mean(air_time, na.rm = TRUE),
    median(air_time, na.rm = TRUE)
  ) %>%
  ungroup()
```


```{r include = FALSE}
# FIXME: introduce count()?
```
```{r 27-fixme-introduce-count}
TRUE
```


```{r include = FALSE}
# FIXME: Copy mre examples from 27-summarize.R?
```
```{r 27-fixme-copy-mre-examples-from-27-summarize-r}
TRUE
```
