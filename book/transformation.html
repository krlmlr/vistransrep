<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Transformation | Visualization, transformation and reporting with the tidyverse</title>
  <meta name="description" content="3 Transformation | Visualization, transformation and reporting with the tidyverse" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Transformation | Visualization, transformation and reporting with the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Transformation | Visualization, transformation and reporting with the tidyverse" />
  
  
  

<meta name="author" content="Kirill Müller, Tobias Schieferdecker, Patrick Schratz" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualization.html"/>
<link rel="next" href="best-practices.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="scroll.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#links"><i class="fa fa-check"></i>Links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#package-versions-used"><i class="fa fa-check"></i>Package versions used</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#speakers"><i class="fa fa-check"></i><b>1.1</b> Speakers</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#overview"><i class="fa fa-check"></i><b>1.2</b> Overview</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#r-as-a-toolkit"><i class="fa fa-check"></i><b>1.3</b> R as a toolkit</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#why-r-and-rstudio"><i class="fa fa-check"></i><b>1.3.1</b> Why R and RStudio?</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#some-r-basics"><i class="fa fa-check"></i><b>1.3.2</b> Some R basics</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#r-code-examples"><i class="fa fa-check"></i><b>1.4</b> R code examples</a><ul>
<li class="chapter" data-level="1.4.1" data-path="introduction.html"><a href="introduction.html#linear-regression"><i class="fa fa-check"></i><b>1.4.1</b> Linear regression</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction.html"><a href="introduction.html#base-r-plot"><i class="fa fa-check"></i><b>1.4.2</b> Base R plot</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction.html"><a href="introduction.html#ggplot2"><i class="fa fa-check"></i><b>1.4.3</b> ggplot2</a></li>
<li class="chapter" data-level="1.4.4" data-path="introduction.html"><a href="introduction.html#gganimate"><i class="fa fa-check"></i><b>1.4.4</b> gganimate</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#r-vs.rstudio"><i class="fa fa-check"></i><b>1.5</b> R vs. RStudio</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#r-vs.r-packages"><i class="fa fa-check"></i><b>1.6</b> R vs. R packages</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#r-packages"><i class="fa fa-check"></i><b>1.7</b> R packages</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#rprofile"><i class="fa fa-check"></i><b>1.8</b> .Rprofile</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#renviron"><i class="fa fa-check"></i><b>1.9</b> .Renviron</a></li>
<li class="chapter" data-level="1.10" data-path="introduction.html"><a href="introduction.html#rstudio"><i class="fa fa-check"></i><b>1.10</b> RStudio</a></li>
<li class="chapter" data-level="1.11" data-path="introduction.html"><a href="introduction.html#rstudio-addins"><i class="fa fa-check"></i><b>1.11</b> RStudio Addins</a></li>
<li class="chapter" data-level="1.12" data-path="introduction.html"><a href="introduction.html#rstudio-projects"><i class="fa fa-check"></i><b>1.12</b> RStudio projects</a></li>
<li class="chapter" data-level="1.13" data-path="introduction.html"><a href="introduction.html#alternatives-to-rstudio"><i class="fa fa-check"></i><b>1.13</b> Alternatives to RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>2</b> Visualization Basics {ggplot2}</a><ul>
<li class="chapter" data-level="2.1" data-path="visualization.html"><a href="visualization.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a><ul>
<li class="chapter" data-level="2.1.1" data-path="visualization.html"><a href="visualization.html#creating-the-plot-skeleton-ggplot"><i class="fa fa-check"></i><b>2.1.1</b> Creating the plot skeleton: <code>ggplot()</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="visualization.html"><a href="visualization.html#what-is-a-statistical-graphic"><i class="fa fa-check"></i><b>2.1.2</b> What is a “statistical graphic”?</a></li>
<li class="chapter" data-level="2.1.3" data-path="visualization.html"><a href="visualization.html#terminology"><i class="fa fa-check"></i><b>2.1.3</b> Terminology</a></li>
<li class="chapter" data-level="2.1.4" data-path="visualization.html"><a href="visualization.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>2.1.4</b> The Grammar of graphics …</a></li>
<li class="chapter" data-level="2.1.5" data-path="visualization.html"><a href="visualization.html#about-ggplot2"><i class="fa fa-check"></i><b>2.1.5</b> About {ggplot2}</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="visualization.html"><a href="visualization.html#geom_-functions"><i class="fa fa-check"></i><b>2.2</b> <code>geom_*</code> functions</a><ul>
<li class="chapter" data-level="2.2.1" data-path="visualization.html"><a href="visualization.html#arguments"><i class="fa fa-check"></i><b>2.2.1</b> Arguments</a></li>
<li class="chapter" data-level="2.2.2" data-path="visualization.html"><a href="visualization.html#combining-geoms"><i class="fa fa-check"></i><b>2.2.2</b> Combining geoms</a></li>
<li class="chapter" data-level="2.2.3" data-path="visualization.html"><a href="visualization.html#summary"><i class="fa fa-check"></i><b>2.2.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="visualization.html"><a href="visualization.html#export-saving"><i class="fa fa-check"></i><b>2.3</b> Export &amp; saving</a><ul>
<li class="chapter" data-level="2.3.1" data-path="visualization.html"><a href="visualization.html#base-r-vs.-ggplot2"><i class="fa fa-check"></i><b>2.3.1</b> Base R vs. {{ggplot2}}</a></li>
<li class="chapter" data-level="2.3.2" data-path="visualization.html"><a href="visualization.html#storing-the-plot-as-an-r-object"><i class="fa fa-check"></i><b>2.3.2</b> Storing the plot as an R object</a></li>
<li class="chapter" data-level="2.3.3" data-path="visualization.html"><a href="visualization.html#best-practices-for-exporting"><i class="fa fa-check"></i><b>2.3.3</b> Best practices for exporting</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="visualization.html"><a href="visualization.html#two-variable-plots"><i class="fa fa-check"></i><b>2.4</b> Two variable plots</a><ul>
<li class="chapter" data-level="2.4.1" data-path="visualization.html"><a href="visualization.html#continuous-x-and-y"><i class="fa fa-check"></i><b>2.4.1</b> Continuous X and Y</a></li>
<li class="chapter" data-level="2.4.2" data-path="visualization.html"><a href="visualization.html#discrete-x-and-continuous-y"><i class="fa fa-check"></i><b>2.4.2</b> Discrete X and continuous Y</a></li>
<li class="chapter" data-level="2.4.3" data-path="visualization.html"><a href="visualization.html#discrete-x-and-y"><i class="fa fa-check"></i><b>2.4.3</b> Discrete X and Y</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="visualization.html"><a href="visualization.html#one-variable-plots"><i class="fa fa-check"></i><b>2.5</b> One variable plots</a><ul>
<li class="chapter" data-level="2.5.1" data-path="visualization.html"><a href="visualization.html#continuous-variables"><i class="fa fa-check"></i><b>2.5.1</b> Continuous variables</a></li>
<li class="chapter" data-level="2.5.2" data-path="visualization.html"><a href="visualization.html#discrete-variables"><i class="fa fa-check"></i><b>2.5.2</b> Discrete variables</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="visualization.html"><a href="visualization.html#colors-and-shape"><i class="fa fa-check"></i><b>2.6</b> Colors and shape</a><ul>
<li class="chapter" data-level="2.6.1" data-path="visualization.html"><a href="visualization.html#static-colors"><i class="fa fa-check"></i><b>2.6.1</b> Static colors</a></li>
<li class="chapter" data-level="2.6.2" data-path="visualization.html"><a href="visualization.html#dynamic-colors"><i class="fa fa-check"></i><b>2.6.2</b> Dynamic colors</a></li>
<li class="chapter" data-level="2.6.3" data-path="visualization.html"><a href="visualization.html#shape"><i class="fa fa-check"></i><b>2.6.3</b> Shape</a></li>
<li class="chapter" data-level="2.6.4" data-path="visualization.html"><a href="visualization.html#combining-color-and-shape"><i class="fa fa-check"></i><b>2.6.4</b> Combining color and shape</a></li>
<li class="chapter" data-level="2.6.5" data-path="visualization.html"><a href="visualization.html#transparency"><i class="fa fa-check"></i><b>2.6.5</b> Transparency</a></li>
<li class="chapter" data-level="2.6.6" data-path="visualization.html"><a href="visualization.html#what-can-go-wrong"><i class="fa fa-check"></i><b>2.6.6</b> What can go wrong</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="visualization.html"><a href="visualization.html#labels"><i class="fa fa-check"></i><b>2.7</b> Labels</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="transformation.html"><a href="transformation.html"><i class="fa fa-check"></i><b>3</b> Transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="transformation.html"><a href="transformation.html#package-conflicted"><i class="fa fa-check"></i><b>3.1</b> Package: {conflicted}</a></li>
<li class="chapter" data-level="3.2" data-path="transformation.html"><a href="transformation.html#filtering-dplyrfilter"><i class="fa fa-check"></i><b>3.2</b> Filtering: <code>dplyr::filter()</code></a></li>
<li class="chapter" data-level="3.3" data-path="transformation.html"><a href="transformation.html#sort-rows-dplyrarrange"><i class="fa fa-check"></i><b>3.3</b> Sort rows: <code>dplyr::arrange()</code></a></li>
<li class="chapter" data-level="3.4" data-path="transformation.html"><a href="transformation.html#the-pipe"><i class="fa fa-check"></i><b>3.4</b> The pipe</a><ul>
<li class="chapter" data-level="3.4.1" data-path="transformation.html"><a href="transformation.html#further-advantages"><i class="fa fa-check"></i><b>3.4.1</b> Further advantages</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="transformation.html"><a href="transformation.html#pick-columns-dplyrselect"><i class="fa fa-check"></i><b>3.5</b> Pick columns: <code>dplyr::select()</code></a></li>
<li class="chapter" data-level="3.6" data-path="transformation.html"><a href="transformation.html#create-new-columns-based-on-old-ones-dplyrmutate"><i class="fa fa-check"></i><b>3.6</b> Create new columns based on old ones: <code>dplyr::mutate()</code></a></li>
<li class="chapter" data-level="3.7" data-path="transformation.html"><a href="transformation.html#summarize-data-by-groups-dplyrsummarize-dplyrgroup_by-dplyrungroup"><i class="fa fa-check"></i><b>3.7</b> Summarize data (by groups): <code>dplyr::summarize()</code>, <code>dplyr::group_by()</code> + <code>dplyr::ungroup()</code></a></li>
<li class="chapter" data-level="3.8" data-path="transformation.html"><a href="transformation.html#summary-plots"><i class="fa fa-check"></i><b>3.8</b> Summary-plots</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="best-practices.html"><a href="best-practices.html"><i class="fa fa-check"></i><b>4</b> Best practices</a><ul>
<li class="chapter" data-level="4.1" data-path="best-practices.html"><a href="best-practices.html#description"><i class="fa fa-check"></i><b>4.1</b> DESCRIPTION</a></li>
<li class="chapter" data-level="4.2" data-path="best-practices.html"><a href="best-practices.html#r"><i class="fa fa-check"></i><b>4.2</b> R</a></li>
<li class="chapter" data-level="4.3" data-path="best-practices.html"><a href="best-practices.html#roxygen2"><i class="fa fa-check"></i><b>4.3</b> roxygen2</a></li>
<li class="chapter" data-level="4.4" data-path="best-practices.html"><a href="best-practices.html#testthat"><i class="fa fa-check"></i><b>4.4</b> testthat</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i># References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualization, transformation and reporting with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="transformation" class="section level1">
<h1><span class="header-section-number">3</span> Transformation</h1>
<blockquote>
<p>Using a consistent grammar of data manipulation.</p>
</blockquote>
<p>This chapter discusses data transformation with the <a href="https://dplyr.tidyverse.org/">dplyr package</a>.</p>
<div id="package-conflicted" class="section level2">
<h2><span class="header-section-number">3.1</span> Package: {conflicted}</h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb64-3" data-line-number="3"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details>
<p>This section is dedicated to show you the basic building blocks (i.e. functions) of data analysis in R within the {tidyverse}.
The package providing these is {dplyr}.</p>
<p>Before starting, we would like to mention the package {conflicted}, which when loaded, will help detecting functions of the same name from different packages (an error is thrown in case of such situations).
It furthermore helps to resolve these situations, by allowing you to choose, the function of which package you prefer (<code>conflicted::conflict_prefer()</code>).
You can see an example in the setup code.</p>
<p>Last time we stopped with facet-plots, e.g. like this one here:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">my_mpg &lt;-<span class="st"> </span>mpg</a>
<a class="sourceLine" id="cb67-2" data-line-number="2"></a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb67-4" data-line-number="4">  <span class="dt">data =</span> mpg,</a>
<a class="sourceLine" id="cb67-5" data-line-number="5">  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)</a>
<a class="sourceLine" id="cb67-6" data-line-number="6">) <span class="op">+</span></a>
<a class="sourceLine" id="cb67-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb67-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_grid</span>(year <span class="op">~</span><span class="st"> </span>drv)</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/21-sample-code-1.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
</div>
<div id="filtering-dplyrfilter" class="section level2">
<h2><span class="header-section-number">3.2</span> Filtering: <code>dplyr::filter()</code></h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb68-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb68-3" data-line-number="3"></a>
<a class="sourceLine" id="cb68-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb68-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details>
<p>During this lecture we will be working with data from the package {nycflights13}, which contains flights in the year 2013 with their departure in New York City (airports: JFK, LGA or EWR) to destinations in the United States, Puerto Rico, and the American Virgin Islands.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">flights</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      517            515         2      830
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      533            529         4      850
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      542            540         2      923
## </span><span style='color: #555555;'># … with 3.368e+05 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">?flights</a></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">?flights</a></code></pre></div>
<p>The function <code>dplyr::filter()</code> helps you to reduce your dataset to the observations (rows) of interest.
The filter condition can use any of the dataset’s variables and needs to be a logical expression.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 8,730 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      517            515         2      830
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      533            529         4      850
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      542            540         2      923
## </span><span style='color: #555555;'># … with 8,727 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<p>If you use one or more variables of the dataset in the filter condition, a vectorized evaluation of the condition is taking place.
Generally you can provide any logical vector with a length equal to the number of rows (or alternatively equal to 1, if you want to keep/drop all rows).</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(dep_time))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 8,255 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1       </span><span style='color: #BB0000;'>NA</span><span>           </span><span style='text-decoration: underline;'>1</span><span>630        </span><span style='color: #BB0000;'>NA</span><span>       </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1       </span><span style='color: #BB0000;'>NA</span><span>           </span><span style='text-decoration: underline;'>1</span><span>935        </span><span style='color: #BB0000;'>NA</span><span>       </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1       </span><span style='color: #BB0000;'>NA</span><span>           </span><span style='text-decoration: underline;'>1</span><span>500        </span><span style='color: #BB0000;'>NA</span><span>       </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'># … with 8,252 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<p>Use <code>&amp;</code> or multiple filters to return only rows that match both criteria:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span> <span class="op">&amp;</span><span class="st"> </span>arr_time <span class="op">&gt;</span><span class="st"> </span><span class="dv">2200</span>)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 0 x 19</span><span>
## </span><span style='color: #555555;'># … with 19 variables: </span><span style='color: #555555;font-weight: bold;'>year</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>month</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>day</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>dep_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>sched_dep_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dep_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&gt;=</span><span class="st"> </span><span class="dv">700</span> <span class="op">&amp;</span><span class="st"> </span>arr_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">800</span>)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 10,654 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1     </span><span style='text-decoration: underline;'>1</span><span>929           </span><span style='text-decoration: underline;'>1</span><span>920         9        3
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1     </span><span style='text-decoration: underline;'>1</span><span>939           </span><span style='text-decoration: underline;'>1</span><span>840        59       29
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1     </span><span style='text-decoration: underline;'>2</span><span>058           </span><span style='text-decoration: underline;'>2</span><span>100        -</span><span style='color: #BB0000;'>2</span><span>        8
## </span><span style='color: #555555;'># … with 1.065e+04 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&gt;=</span><span class="st"> </span><span class="dv">700</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(arr_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">800</span>)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 10,654 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1     </span><span style='text-decoration: underline;'>1</span><span>929           </span><span style='text-decoration: underline;'>1</span><span>920         9        3
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1     </span><span style='text-decoration: underline;'>1</span><span>939           </span><span style='text-decoration: underline;'>1</span><span>840        59       29
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1     </span><span style='text-decoration: underline;'>2</span><span>058           </span><span style='text-decoration: underline;'>2</span><span>100        -</span><span style='color: #BB0000;'>2</span><span>        8
## </span><span style='color: #555555;'># … with 1.065e+04 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<p>Use <code>|</code> to return all rows that match either criterion or both:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span> <span class="op">|</span><span class="st"> </span>arr_time <span class="op">&gt;</span><span class="st"> </span><span class="dv">2200</span>)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 40,879 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      517            515         2      830
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      533            529         4      850
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      542            540         2      923
## </span><span style='color: #555555;'># … with 4.088e+04 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
</div>
<div id="sort-rows-dplyrarrange" class="section level2">
<h2><span class="header-section-number">3.3</span> Sort rows: <code>dplyr::arrange()</code></h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb80-3" data-line-number="3"></a>
<a class="sourceLine" id="cb80-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb80-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details>
<p>The function <code>dplyr::arrange()</code> sorts the rows of the dataset according to the values of the variable(s) you are providing.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(dep_time)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1    13        1           </span><span style='text-decoration: underline;'>2</span><span>249        72      108
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1    31        1           </span><span style='text-decoration: underline;'>2</span><span>100       181      124
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013    11    13        1           </span><span style='text-decoration: underline;'>2</span><span>359         2      442
## </span><span style='color: #555555;'># … with 3.368e+05 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<p>When providing multiple variables as arguments for <code>...</code> (the ellipsis), the dataset is first sorted accorcing to the values of the first variable.
Wherever these values occur more than once, another sorting takes place within those groups, according to the second variable you provided.
The same rule applies for every further variable you add to <code>arrange()</code>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(dep_time, dep_delay)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013    11    13        1           </span><span style='text-decoration: underline;'>2</span><span>359         2      442
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013    12    16        1           </span><span style='text-decoration: underline;'>2</span><span>359         2      447
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013    12    20        1           </span><span style='text-decoration: underline;'>2</span><span>359         2      430
## </span><span style='color: #555555;'># … with 3.368e+05 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<p>You can combine <code>filter()</code> and <code>arrange()</code>.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(dep_time, dep_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>You can use <code>arrange()</code> with arbitrary expressions.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">is.na</span>(dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>The reason for the result you just saw in the view of the filtered dataset is, that the binary result of the expression (<code>TRUE</code>, <code>FALSE</code>) is sorted <code>FALSE</code> first (lexicographically).</p>
<p>Let’s give it a twist:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>Sorting the dataset according to which flights arrived earliest on April 1, 2013:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>Invert the sorting by either…</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>… or:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb90-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb90-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb90-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>You can mix sorting in an ascending and a descending manner:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(dep_time, <span class="kw">desc</span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
</div>
<div id="the-pipe" class="section level2">
<h2><span class="header-section-number">3.4</span> The pipe</h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb92-3" data-line-number="3"></a>
<a class="sourceLine" id="cb92-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb92-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details>
<p>We already heavily used it today, but what exactly are the characteristics of <code>%&gt;%</code>, better known as “the pipe”?</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">early_flights &lt;-</a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a></code></pre></div>
<p>The above is just another way of writing:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">early_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a></code></pre></div>
<p>The manual describes this operator in detail:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">?<span class="st">&quot;%&gt;%&quot;</span></a></code></pre></div>
<p>With the pipe, code can be read in a natural way, from left to right.
The following snippet extracts</p>
<ol style="list-style-type: decimal">
<li>all early flights</li>
<li>from October till December,</li>
<li>ordered by departure time and then departure delay</li>
<li>and displays it.</li>
</ol>
<p>Note how the reading corresponds to the code.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(dep_time, dep_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb98-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>This is possible, because all transformation verbs (<code>filter()</code>, <code>arrange()</code>, <code>view()</code>) accept the main input (a tibble) as the first argument and also return a tibble.</p>
<p>The following three codes are equivalent, but are more difficult to write, to read and to maintain.</p>
<p>Naming is hard.
Trying to give each intermediate result a name is exhausting.
Introducing an additional step in this sequence of operations is prone to errors.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">early_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a>
<a class="sourceLine" id="cb99-2" data-line-number="2">early_flights_oct_dec &lt;-<span class="st"> </span><span class="kw">filter</span>(early_flights, month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb99-3" data-line-number="3">early_flights_oct_dec_sorted &lt;-<span class="st"> </span><span class="kw">arrange</span>(early_flights_oct_dec, dep_time, dep_delay)</a>
<a class="sourceLine" id="cb99-4" data-line-number="4"><span class="kw">view</span>(early_flights_oct_dec_sorted)</a></code></pre></div>
<p>We can keep using the same variable, e.g. <code>x</code>, to avoid naming.
This adds noise compared to the pipe.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1">x &lt;-<span class="st"> </span>flights</a>
<a class="sourceLine" id="cb100-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">filter</span>(x, dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a>
<a class="sourceLine" id="cb100-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw">filter</span>(x, month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb100-4" data-line-number="4">x &lt;-<span class="st"> </span><span class="kw">arrange</span>(x, dep_time, dep_delay)</a>
<a class="sourceLine" id="cb100-5" data-line-number="5"><span class="kw">view</span>(x)</a></code></pre></div>
<p>We can avoid intermediate variables.
This disconnects the verbs from their arguments and is very difficult to read.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="kw">view</span>(</a>
<a class="sourceLine" id="cb101-2" data-line-number="2">  <span class="kw">arrange</span>(</a>
<a class="sourceLine" id="cb101-3" data-line-number="3">    <span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb101-4" data-line-number="4">      <span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb101-5" data-line-number="5">        flights,</a>
<a class="sourceLine" id="cb101-6" data-line-number="6">        dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span></a>
<a class="sourceLine" id="cb101-7" data-line-number="7">      ),</a>
<a class="sourceLine" id="cb101-8" data-line-number="8">      month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb101-9" data-line-number="9">    ),</a>
<a class="sourceLine" id="cb101-10" data-line-number="10">    dep_time, dep_delay</a>
<a class="sourceLine" id="cb101-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb101-12" data-line-number="12">)</a></code></pre></div>
<div id="further-advantages" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Further advantages</h3>
<p>When working on a code chunk consisting of subsequent transformations connected by pipes, it can be useful to end the pipeline with either <code>I</code> or <code>view()</code>.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb102-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb102-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>I</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 1,894 x 19</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
## </span><span style='color: #555555;'>*</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013    10     1      447            500       -</span><span style='color: #BB0000;'>13</span><span>      614
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013    10     1      522            517         5      735
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013    10     1      536            545        -</span><span style='color: #BB0000;'>9</span><span>      809
## </span><span style='color: #555555;'># … with 1,891 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">##arrange(dep_time, dep_delay) %&gt;%</a>
<a class="sourceLine" id="cb103-2" data-line-number="2">##view()</a></code></pre></div>
<p>Once the chunk does what you expect it to do, do not forget to remove the <code>I</code> or <code>view()</code> call.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="kw">try</span>(</a>
<a class="sourceLine" id="cb104-2" data-line-number="2">  <span class="kw">arrange</span>(dep_time, dep_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb104-3" data-line-number="3"><span class="st">  </span><span class="kw">view</span>()</a>
<a class="sourceLine" id="cb104-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## Error in arrange(dep_time, dep_delay) : object &#39;dep_time&#39; not found</code></pre>
<p>To rearrange rows, you can use the shortcut <code>Alt + Cursor up/down</code>.
In a piped expression, no further editing is necessary!</p>
</div>
</div>
<div id="pick-columns-dplyrselect" class="section level2">
<h2><span class="header-section-number">3.5</span> Pick columns: <code>dplyr::select()</code></h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb106-3" data-line-number="3"></a>
<a class="sourceLine" id="cb106-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb106-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details>
<p>With <code>dplyr::select()</code> you can (de-)select and/or rename columns of your dataset.
The basic operation is like in the following examples:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year, month, day)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 3</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1
## </span><span style='color: #555555;'># … with 3.368e+05 more rows</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>year)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 18</span><span>
##   </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>     1     1      517            515         2      830
## </span><span style='color: #555555;'>2</span><span>     1     1      533            529         4      850
## </span><span style='color: #555555;'>3</span><span>     1     1      542            540         2      923
## </span><span style='color: #555555;'># … with 3.368e+05 more rows, and 12 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<p>Renaming works by addressing an existing column on the right hand side of an equality sign and providing the new name of the column on its left hand side.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb111-3" data-line-number="3">    year, month, day,</a>
<a class="sourceLine" id="cb111-4" data-line-number="4">    <span class="dt">departure_delay =</span> dep_delay,</a>
<a class="sourceLine" id="cb111-5" data-line-number="5">    <span class="dt">arrival_delay =</span> arr_delay</a>
<a class="sourceLine" id="cb111-6" data-line-number="6">  )</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 5</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>departure_delay</span><span> </span><span style='font-weight: bold;'>arrival_delay</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>           </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1               2            11
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1               4            20
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1               2            33
## </span><span style='color: #555555;'># … with 3.368e+05 more rows</span><span>
</span></CODE></PRE>
<p>With backticks, it is possible, but not advised, to use arbitrary characters (including spaces) in column names:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">flights_with_spaces &lt;-</a>
<a class="sourceLine" id="cb112-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb112-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb112-4" data-line-number="4">    year, month, day,</a>
<a class="sourceLine" id="cb112-5" data-line-number="5">    <span class="st">`</span><span class="dt">Departure delay</span><span class="st">`</span> =<span class="st"> </span>dep_delay,</a>
<a class="sourceLine" id="cb112-6" data-line-number="6">    <span class="st">`</span><span class="dt">Arrival delay</span><span class="st">`</span> =<span class="st"> </span>arr_delay</a>
<a class="sourceLine" id="cb112-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb112-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb112-9" data-line-number="9">    <span class="st">`</span><span class="dt">Arrival delay</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb112-10" data-line-number="10">  )</a></code></pre></div>
<p>Address them in the same way, if the dataset already has such variables:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1">flights_with_spaces <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb113-3" data-line-number="3">    year, month, day,</a>
<a class="sourceLine" id="cb113-4" data-line-number="4">    <span class="dt">dep_delay =</span> <span class="st">`</span><span class="dt">Departure delay</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb113-5" data-line-number="5">    <span class="dt">arr_delay =</span> <span class="st">`</span><span class="dt">Arrival delay</span><span class="st">`</span></a>
<a class="sourceLine" id="cb113-6" data-line-number="6">  )</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 188,933 x 5</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_delay</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1        -</span><span style='color: #BB0000;'>1</span><span>       -</span><span style='color: #BB0000;'>18</span><span>
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1        -</span><span style='color: #BB0000;'>6</span><span>       -</span><span style='color: #BB0000;'>25</span><span>
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1        -</span><span style='color: #BB0000;'>3</span><span>       -</span><span style='color: #BB0000;'>14</span><span>
## </span><span style='color: #555555;'># … with 1.889e+05 more rows</span><span>
</span></CODE></PRE>
<p>The {janitor} package helps fixing issues with colum names automatically.</p>
<p>Select helpers allow selecting multiple related columns conveniently.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(origin, dest, <span class="kw">ends_with</span>(<span class="st">&quot;_time&quot;</span>))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 7</span><span>
##   </span><span style='font-weight: bold;'>origin</span><span> </span><span style='font-weight: bold;'>dest</span><span>  </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>arr_time</span><span> </span><span style='font-weight: bold;'>sched_arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> EWR    IAH        517            515      830            819
## </span><span style='color: #555555;'>2</span><span> LGA    IAH        533            529      850            830
## </span><span style='color: #555555;'>3</span><span> JFK    MIA        542            540      923            850
## </span><span style='color: #555555;'># … with 3.368e+05 more rows, and 1 more variable:
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
</span></CODE></PRE>
</div>
<div id="create-new-columns-based-on-old-ones-dplyrmutate" class="section level2">
<h2><span class="header-section-number">3.6</span> Create new columns based on old ones: <code>dplyr::mutate()</code></h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb115-3" data-line-number="3"></a>
<a class="sourceLine" id="cb115-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb115-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="kw">conflict_prefer</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
</details>
<p>With <code>dplyr::mutate()</code> you can add new columns to a table, e.g. making use of the already existing variables.</p>
<p>How much faster than the scheduled time did the pilots manage to fly:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recovery =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 20</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>sched_dep_time</span><span> </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      517            515         2      830
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      533            529         4      850
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      542            540         2      923
## </span><span style='color: #555555;'># … with 3.368e+05 more rows, and 13 more variables:
## #   </span><span style='color: #555555;font-weight: bold;'>sched_arr_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>arr_delay</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>carrier</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>flight</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>tailnum</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>origin</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>dest</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>air_time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>distance</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>minute</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>time_hour</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>recovery</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
</span></CODE></PRE>
<p>This is another building block added to the toolset:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recovery =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(dep_delay, arr_delay, recovery)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 3</span><span>
##   </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_delay</span><span> </span><span style='font-weight: bold;'>recovery</span><span>
##       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>         2        11       -</span><span style='color: #BB0000;'>9</span><span>
## </span><span style='color: #555555;'>2</span><span>         4        20      -</span><span style='color: #BB0000;'>16</span><span>
## </span><span style='color: #555555;'>3</span><span>         2        33      -</span><span style='color: #BB0000;'>31</span><span>
## </span><span style='color: #555555;'># … with 3.368e+05 more rows</span><span>
</span></CODE></PRE>
<p>Work with the newly created variable just like with the original ones:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recovery =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(dep_delay, arr_delay, recovery) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(recovery)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 3</span><span>
##   </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_delay</span><span> </span><span style='font-weight: bold;'>recovery</span><span>
##       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>        -</span><span style='color: #BB0000;'>2</span><span>       194     -</span><span style='color: #BB0000;'>196</span><span>
## </span><span style='color: #555555;'>2</span><span>        -</span><span style='color: #BB0000;'>2</span><span>       179     -</span><span style='color: #BB0000;'>181</span><span>
## </span><span style='color: #555555;'>3</span><span>       180       345     -</span><span style='color: #BB0000;'>165</span><span>
## </span><span style='color: #555555;'># … with 3.368e+05 more rows</span><span>
</span></CODE></PRE>
<p>Assign the results to new variables.
The old ones remain unchanged.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">recovery_data &lt;-</a>
<a class="sourceLine" id="cb124-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recovery =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(dep_delay, arr_delay, recovery) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(recovery)</a>
<a class="sourceLine" id="cb124-6" data-line-number="6"></a>
<a class="sourceLine" id="cb124-7" data-line-number="7">recovery_data</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 3</span><span>
##   </span><span style='font-weight: bold;'>dep_delay</span><span> </span><span style='font-weight: bold;'>arr_delay</span><span> </span><span style='font-weight: bold;'>recovery</span><span>
##       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>        -</span><span style='color: #BB0000;'>2</span><span>       194     -</span><span style='color: #BB0000;'>196</span><span>
## </span><span style='color: #555555;'>2</span><span>        -</span><span style='color: #BB0000;'>2</span><span>       179     -</span><span style='color: #BB0000;'>181</span><span>
## </span><span style='color: #555555;'>3</span><span>       180       345     -</span><span style='color: #BB0000;'>165</span><span>
## </span><span style='color: #555555;'># … with 3.368e+05 more rows</span><span>
</span></CODE></PRE>
<p>Let’s look at a single airplane:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-4" data-line-number="4"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>Adding the departure time of the <em>next</em> flight to the current row, respectively, using <code>mutate()</code> with <code>lead()</code>:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lead_dep_time =</span> <span class="kw">lead</span>(dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>The opposite effect to <code>lead()</code> can be realized using <code>lag()</code>:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_arr_time =</span> <span class="kw">lag</span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>There is even a use-case for this in our little example.
How long has our airplane been absent from NYC airports between each of its flights out?</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb128-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb128-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_arr_time =</span> <span class="kw">lag</span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb128-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ground_time =</span> dep_time <span class="op">-</span><span class="st"> </span>lag_arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb128-6" data-line-number="6"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>The negative values occur because not everything happens on the same day, implying that our method is still in need of some refinement.
Nevertheless, let’s continue.</p>
<p>A frequently used workflow is creating a helper variable at some point in the pipeline and then dropping it later on:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_arr_time =</span> <span class="kw">lag</span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ground_time =</span> dep_time <span class="op">-</span><span class="st"> </span>lag_arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lag_arr_time)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 111 x 6</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>dep_time</span><span> </span><span style='font-weight: bold;'>arr_time</span><span> </span><span style='font-weight: bold;'>ground_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1      517      830          </span><span style='color: #BB0000;'>NA</span><span>
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     8     </span><span style='text-decoration: underline;'>1</span><span>435     </span><span style='text-decoration: underline;'>1</span><span>717         605
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     9      717      812       -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>000</span><span>
## </span><span style='color: #555555;'># … with 108 more rows</span><span>
</span></CODE></PRE>
<p>Let’s work some more with the flight data of our special plane.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-3" data-line-number="3"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>The total air time of a plane up to and including a given flight can be calculated with <code>base::cumsum()</code>:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_air_time =</span> <span class="kw">cumsum</span>(air_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(air_time, cum_air_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<p>Creating a “flag” variable with <code>mutate()</code> which shows if a flight was on time or not:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> <span class="kw">if_else</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;delayed&quot;</span>, <span class="st">&quot;on time&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 111 x 2</span><span>
##   </span><span style='font-weight: bold;'>arr_delay</span><span> </span><span style='font-weight: bold;'>delayed</span><span>
##       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  
## </span><span style='color: #555555;'>1</span><span>        11 delayed
## </span><span style='color: #555555;'>2</span><span>       -</span><span style='color: #BB0000;'>29</span><span> on time
## </span><span style='color: #555555;'>3</span><span>        -</span><span style='color: #BB0000;'>3</span><span> on time
## </span><span style='color: #555555;'># … with 108 more rows</span><span>
</span></CODE></PRE>
<p>A more straightforward way to get the same (or at least a very similar and probably easier to work with) result:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 111 x 2</span><span>
##   </span><span style='font-weight: bold;'>arr_delay</span><span> </span><span style='font-weight: bold;'>delayed</span><span>
##       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;lgl&gt;</span><span>  
## </span><span style='color: #555555;'>1</span><span>        11 TRUE   
## </span><span style='color: #555555;'>2</span><span>       -</span><span style='color: #BB0000;'>29</span><span> FALSE  
## </span><span style='color: #555555;'>3</span><span>        -</span><span style='color: #BB0000;'>3</span><span> FALSE  
## </span><span style='color: #555555;'># … with 108 more rows</span><span>
</span></CODE></PRE>
<p>… easier to work with, because <code>filter()</code> can directly take logical arguments:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(delayed)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 39 x 2</span><span>
##   </span><span style='font-weight: bold;'>arr_delay</span><span> </span><span style='font-weight: bold;'>delayed</span><span>
##       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;lgl&gt;</span><span>  
## </span><span style='color: #555555;'>1</span><span>        11 TRUE   
## </span><span style='color: #555555;'>2</span><span>        39 TRUE   
## </span><span style='color: #555555;'>3</span><span>        54 TRUE   
## </span><span style='color: #555555;'># … with 36 more rows</span><span>
</span></CODE></PRE>
<p>Negation for inverse filtering:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>delayed)</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 72 x 2</span><span>
##   </span><span style='font-weight: bold;'>arr_delay</span><span> </span><span style='font-weight: bold;'>delayed</span><span>
##       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;lgl&gt;</span><span>  
## </span><span style='color: #555555;'>1</span><span>       -</span><span style='color: #BB0000;'>29</span><span> FALSE  
## </span><span style='color: #555555;'>2</span><span>        -</span><span style='color: #BB0000;'>3</span><span> FALSE  
## </span><span style='color: #555555;'>3</span><span>       -</span><span style='color: #BB0000;'>20</span><span> FALSE  
## </span><span style='color: #555555;'># … with 69 more rows</span><span>
</span></CODE></PRE>
<p>These are the flights that had no delay:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1">on_time_flights &lt;-</a>
<a class="sourceLine" id="cb136-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>delayed)</a></code></pre></div>
</div>
<div id="summarize-data-by-groups-dplyrsummarize-dplyrgroup_by-dplyrungroup" class="section level2">
<h2><span class="header-section-number">3.7</span> Summarize data (by groups): <code>dplyr::summarize()</code>, <code>dplyr::group_by()</code> + <code>dplyr::ungroup()</code></h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb137-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb137-3" data-line-number="3"></a>
<a class="sourceLine" id="cb137-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb137-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1"><span class="kw">conflict_prefer</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
</details>
<p>Often we want to draw just conclusions from larger datasets by gaining insight by using statistical (or other) methods for summarizing – and thus drastically reducing – the data:
How much time did all planes spend in the air?</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(air_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb143-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_air_time =</span> <span class="kw">sum</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 336,776 x 2</span><span>
##   </span><span style='font-weight: bold;'>air_time</span><span> </span><span style='font-weight: bold;'>total_air_time</span><span>
##      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>          </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>      227       49</span><span style='text-decoration: underline;'>326</span><span>610
## </span><span style='color: #555555;'>2</span><span>      227       49</span><span style='text-decoration: underline;'>326</span><span>610
## </span><span style='color: #555555;'>3</span><span>      160       49</span><span style='text-decoration: underline;'>326</span><span>610
## </span><span style='color: #555555;'># … with 3.368e+05 more rows</span><span>
</span></CODE></PRE>
<p>The <code>mutate()</code> call adds a new variable with the same value across all rows.
To reduce the result to a single row, use <code>summarize()</code>:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total_air_time =</span> <span class="kw">sum</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 1 x 1</span><span>
##   </span><span style='font-weight: bold;'>total_air_time</span><span>
##            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>       49</span><span style='text-decoration: underline;'>326</span><span>610
</span></CODE></PRE>
<p>Simple counts can be computed with <code>n()</code> inside <code>summarize()</code>:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 1 x 1</span><span>
##        </span><span style='font-weight: bold;'>n</span><span>
##    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> </span><span style='text-decoration: underline;'>336</span><span>776
</span></CODE></PRE>
<p>A variety of aggregate functions is supported:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">median =</span> <span class="kw">median</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 1 x 1</span><span>
##   </span><span style='font-weight: bold;'>median</span><span>
##    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>    129
</span></CODE></PRE>
<p>It’s possible to produce two different summarizations at once:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb147-3" data-line-number="3">    <span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb147-4" data-line-number="4">    <span class="dt">mean_air_time =</span> <span class="kw">mean</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb147-5" data-line-number="5">    <span class="dt">median_air_time =</span> <span class="kw">median</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb147-6" data-line-number="6">  )</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 1 x 3</span><span>
##        </span><span style='font-weight: bold;'>n</span><span> </span><span style='font-weight: bold;'>mean_air_time</span><span> </span><span style='font-weight: bold;'>median_air_time</span><span>
##    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>           </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> </span><span style='text-decoration: underline;'>336</span><span>776          151.             129
</span></CODE></PRE>
<p>The <code>summarize()</code> verb gains its full power in grouped operations.
Surround with <code>group_by()</code> and <code>ungroup()</code> to compute summaries in groups defined by common values in one or more columns.
In the next example, the same summary is computed separately for each origin airport.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb148-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(origin) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb148-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb148-4" data-line-number="4">    <span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb148-5" data-line-number="5">    <span class="dt">mean_air_time =</span> <span class="kw">mean</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb148-6" data-line-number="6">    <span class="dt">median_air_time =</span> <span class="kw">median</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb148-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb148-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 3 x 4</span><span>
##   </span><span style='font-weight: bold;'>origin</span><span>      </span><span style='font-weight: bold;'>n</span><span> </span><span style='font-weight: bold;'>mean_air_time</span><span> </span><span style='font-weight: bold;'>median_air_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>           </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> EWR    </span><span style='text-decoration: underline;'>120</span><span>835          153.             130
## </span><span style='color: #555555;'>2</span><span> JFK    </span><span style='text-decoration: underline;'>111</span><span>279          178.             149
## </span><span style='color: #555555;'>3</span><span> LGA    </span><span style='text-decoration: underline;'>104</span><span>662          118.             115
</span></CODE></PRE>
<p>The next example splits the data into one group for each day.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb149-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb149-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb149-4" data-line-number="4">    <span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb149-5" data-line-number="5">    <span class="dt">mean_air_time =</span> <span class="kw">mean</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb149-6" data-line-number="6">    <span class="dt">median_air_time =</span> <span class="kw">median</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb149-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb149-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 365 x 6</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span>     </span><span style='font-weight: bold;'>n</span><span> </span><span style='font-weight: bold;'>mean_air_time</span><span> </span><span style='font-weight: bold;'>median_air_time</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>           </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1   842          170.             149
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     2   943          162.             148
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     3   914          157.             148
## </span><span style='color: #555555;'># … with 362 more rows</span><span>
</span></CODE></PRE>
<p>For quick exploration, the names of the new columns can be omitted:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb150-4" data-line-number="4">    <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb150-5" data-line-number="5">    <span class="kw">mean</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb150-6" data-line-number="6">    <span class="kw">median</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb150-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 365 x 6</span><span>
##    </span><span style='font-weight: bold;'>year</span><span> </span><span style='font-weight: bold;'>month</span><span>   </span><span style='font-weight: bold;'>day</span><span> </span><span style='font-weight: bold;'>`n()`</span><span> </span><span style='font-weight: bold;'>`mean(air_time, n…</span><span> </span><span style='font-weight: bold;'>`median(air_time…</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>              </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     1   842               170.               149
## </span><span style='color: #555555;'>2</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     2   943               162.               148
## </span><span style='color: #555555;'>3</span><span>  </span><span style='text-decoration: underline;'>2</span><span>013     1     3   914               157.               148
## </span><span style='color: #555555;'># … with 362 more rows</span><span>
</span></CODE></PRE>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1"><span class="ot">TRUE</span></a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="ot">TRUE</span></a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="summary-plots" class="section level2">
<h2><span class="header-section-number">3.8</span> Summary-plots</h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb155-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb155-3" data-line-number="3"></a>
<a class="sourceLine" id="cb155-4" data-line-number="4"><span class="kw">library</span>(conflicted)</a>
<a class="sourceLine" id="cb155-5" data-line-number="5"><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw">conflict_prefer</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
</details>
<p>Potentially surprisingly, <code>mutate()</code> can also work with the results of a <code>ggplot()</code> call.
Let’s approach this step by step.
Here is a basic barplot of <code>flights$carrier</code>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> carrier)) <span class="op">+</span></a>
<a class="sourceLine" id="cb161-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/28-bar-plot-flights-per-carrier-1.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<p>Same with one facet per month:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> carrier)) <span class="op">+</span></a>
<a class="sourceLine" id="cb162-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb162-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>month)</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/28-bar-plot-flights-per-carrier-one-facet-per-month-1.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<p>We can extract a function that takes any data and produces a barplot of the variable <code>carrier</code>:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">plot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb163-2" data-line-number="2">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-3" data-line-number="3"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> carrier)) <span class="op">+</span></a>
<a class="sourceLine" id="cb163-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_bar</span>()</a>
<a class="sourceLine" id="cb163-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb163-6" data-line-number="6"></a>
<a class="sourceLine" id="cb163-7" data-line-number="7"><span class="kw">plot_fun</span>(flights)</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/28-extract-a-function-1.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<p>The result of <code>ggplot()</code> is first and foremost an object.
Only when R tries to display it on the console a method is triggered, which causes it to show the graph in the “Viewer”.
Therefore, we can use the <code>group_by</code> – <code>summarize()</code> – <code>ungroup()</code> pattern to produce one plot per group and store it in a new column:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">plot_df &lt;-</a>
<a class="sourceLine" id="cb164-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb164-5" data-line-number="5">    <span class="dt">plot =</span> <span class="kw">list</span>(<span class="kw">plot_fun</span>(<span class="kw">tibble</span>(carrier)))</a>
<a class="sourceLine" id="cb164-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb164-8" data-line-number="8"></a>
<a class="sourceLine" id="cb164-9" data-line-number="9">plot_df</a></code></pre></div>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 12 x 2</span><span>
##   </span><span style='font-weight: bold;'>month</span><span> </span><span style='font-weight: bold;'>plot</span><span>  
##   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span>     1 </span><span style='color: #555555;'>&lt;gg&gt;</span><span>  
## </span><span style='color: #555555;'>2</span><span>     2 </span><span style='color: #555555;'>&lt;gg&gt;</span><span>  
## </span><span style='color: #555555;'>3</span><span>     3 </span><span style='color: #555555;'>&lt;gg&gt;</span><span>  
## </span><span style='color: #555555;'># … with 9 more rows</span><span>
</span></CODE></PRE>
<p>When using <code>dplyr::pull()</code> (this function “extracts” a variable from a <code>data.frame</code> and returns it as a normal vector), each of the plots will be subsequently displayed in your “Viewer”.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1">plot_df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-2" data-line-number="2"><span class="st">  </span><span class="kw">pull</span>()</a></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-1.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-2.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-3.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-4.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-5.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-6.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-7.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-8.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-9.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[10]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-10.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[11]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-11.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<pre><code>## 
## [[12]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-12.png" width="288" style="display: block; margin: auto 0 auto auto;" /></p>
<p>Use the left arrow to click through the different plots.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="best-practices.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/krlmlr/vistransrep/edit/master/02-Transformation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["vistransrep.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
