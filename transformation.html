<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>3 Transformation | Visualization, transformation and reporting with the tidyverse</title>
<meta name="description" content="3 Transformation | Visualization, transformation and reporting with the tidyverse">
<meta name="generator" content="bookdown 0.16 and GitBook 2.6.7">
<meta property="og:title" content="3 Transformation | Visualization, transformation and reporting with the tidyverse">
<meta property="og:type" content="book">
<meta property="og:url" content="https://krlmlr.github.io/vistransrep">
<meta name="github-repo" content="krlmlr/vistransrep">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3 Transformation | Visualization, transformation and reporting with the tidyverse">
<meta name="author" content="Kirill Müller, Tobias Schieferdecker, Patrick Schratz">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="prev" href="vis-basics.html">
<link rel="next" href="import.html">
<script src="libs/jquery/jquery.min.js"></script><link href="libs/gitbook/css/style.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet">
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/d3-lasso/d3-lasso.min.js"></script><link href="libs/ggiraphjs/styles.css" rel="stylesheet">
<script src="libs/ggiraphjs/ggiraphjs.min.js"></script><script src="libs/girafe-binding/girafe.js"></script><style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<link rel="stylesheet" href="scroll.css" type="text/css">
<link rel="stylesheet" href="extra.css" type="text/css">
</head>
<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation"><ul class="summary">
<li><strong><a href="./">vis trans rep</a></strong></li>

<li class="divider">
<li class="chapter" data-level="" data-path="index.html">
<a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#links-to-material-for-past-workshops"><i class="fa fa-check"></i>Links to material for past workshops</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#links"><i class="fa fa-check"></i>Links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#download-data-and-code"><i class="fa fa-check"></i>Download data and code</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#package-versions-used"><i class="fa fa-check"></i>Package versions used</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#speakers"><i class="fa fa-check"></i>Speakers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
</ul>
</li>
<li class="chapter" data-level="1" data-path="r-and-rstudio.html">
<a href="r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> R and RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="r-and-rstudio.html">
<a href="r-and-rstudio.html#r-as-a-toolkit"><i class="fa fa-check"></i><b>1.1</b> R as a toolkit</a><ul>
<li class="chapter" data-level="1.1.1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#why-r-and-rstudio"><i class="fa fa-check"></i><b>1.1.1</b> Why R and RStudio?</a></li>
<li class="chapter" data-level="1.1.2" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#some-r-basics"><i class="fa fa-check"></i><b>1.1.2</b> Some R basics</a></li>
</ul>
</li>
<li class="chapter" data-level="1.2" data-path="r-and-rstudio.html">
<a href="r-and-rstudio.html#r-code-examples"><i class="fa fa-check"></i><b>1.2</b> R code examples</a><ul>
<li class="chapter" data-level="1.2.1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#linear-regression"><i class="fa fa-check"></i><b>1.2.1</b> Linear regression</a></li>
<li class="chapter" data-level="1.2.2" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#base-r-plot"><i class="fa fa-check"></i><b>1.2.2</b> Base R plot</a></li>
<li class="chapter" data-level="1.2.3" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#ggplot2"><i class="fa fa-check"></i><b>1.2.3</b> ggplot2</a></li>
<li class="chapter" data-level="1.2.4" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#gganimate"><i class="fa fa-check"></i><b>1.2.4</b> gganimate</a></li>
</ul>
</li>
<li class="chapter" data-level="1.3" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-vs.rstudio"><i class="fa fa-check"></i><b>1.3</b> R vs. RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-vs.r-packages"><i class="fa fa-check"></i><b>1.4</b> R vs. R packages</a></li>
<li class="chapter" data-level="1.5" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-packages"><i class="fa fa-check"></i><b>1.5</b> R packages</a></li>
<li class="chapter" data-level="1.6" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#rprofile"><i class="fa fa-check"></i><b>1.6</b> .Rprofile</a></li>
<li class="chapter" data-level="1.7" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#renviron"><i class="fa fa-check"></i><b>1.7</b> .Renviron</a></li>
<li class="chapter" data-level="1.8" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#rstudio"><i class="fa fa-check"></i><b>1.8</b> RStudio</a></li>
<li class="chapter" data-level="1.9" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#rstudio-addins"><i class="fa fa-check"></i><b>1.9</b> RStudio addins</a></li>
<li class="chapter" data-level="1.10" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#rstudio-projects"><i class="fa fa-check"></i><b>1.10</b> RStudio projects</a></li>
<li class="chapter" data-level="1.11" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#alternatives-to-rstudio"><i class="fa fa-check"></i><b>1.11</b> Alternatives to RStudio</a></li>
</ul>
</li>
<li class="chapter" data-level="2" data-path="vis-basics.html">
<a href="vis-basics.html"><i class="fa fa-check"></i><b>2</b> Visualization</a><ul>
<li class="chapter" data-level="2.1" data-path="vis-basics.html">
<a href="vis-basics.html#basics-for-visualisation-in-r-using-ggplot2"><i class="fa fa-check"></i><b>2.1</b> Basics for visualisation in R using {ggplot2}</a><ul>
<li class="chapter" data-level="2.1.1" data-path="vis-basics.html"><a href="vis-basics.html#creating-the-plot-skeleton-ggplot"><i class="fa fa-check"></i><b>2.1.1</b> Creating the plot skeleton: <code>ggplot()</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="vis-basics.html"><a href="vis-basics.html#what-is-a-statistical-graphic"><i class="fa fa-check"></i><b>2.1.2</b> What is a “statistical graphic”?</a></li>
<li class="chapter" data-level="2.1.3" data-path="vis-basics.html"><a href="vis-basics.html#terminology"><i class="fa fa-check"></i><b>2.1.3</b> Terminology</a></li>
<li class="chapter" data-level="2.1.4" data-path="vis-basics.html"><a href="vis-basics.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>2.1.4</b> The Grammar of graphics …</a></li>
<li class="chapter" data-level="2.1.5" data-path="vis-basics.html"><a href="vis-basics.html#about-ggplot2"><i class="fa fa-check"></i><b>2.1.5</b> About {ggplot2}</a></li>
</ul>
</li>
<li class="chapter" data-level="2.2" data-path="vis-basics.html">
<a href="vis-basics.html#geom_-functions"><i class="fa fa-check"></i><b>2.2</b> <code>geom_*</code> functions</a><ul>
<li class="chapter" data-level="2.2.1" data-path="vis-basics.html"><a href="vis-basics.html#arguments"><i class="fa fa-check"></i><b>2.2.1</b> Arguments</a></li>
<li class="chapter" data-level="2.2.2" data-path="vis-basics.html"><a href="vis-basics.html#combining-geoms"><i class="fa fa-check"></i><b>2.2.2</b> Combining geoms</a></li>
<li class="chapter" data-level="2.2.3" data-path="vis-basics.html"><a href="vis-basics.html#summary"><i class="fa fa-check"></i><b>2.2.3</b> Summary</a></li>
</ul>
</li>
<li class="chapter" data-level="2.3" data-path="vis-basics.html">
<a href="vis-basics.html#two-variable-plots"><i class="fa fa-check"></i><b>2.3</b> Two variable plots</a><ul>
<li class="chapter" data-level="2.3.1" data-path="vis-basics.html"><a href="vis-basics.html#continuous-x-and-y"><i class="fa fa-check"></i><b>2.3.1</b> Continuous X and Y</a></li>
<li class="chapter" data-level="2.3.2" data-path="vis-basics.html"><a href="vis-basics.html#discrete-x-and-continuous-y"><i class="fa fa-check"></i><b>2.3.2</b> Discrete X and continuous Y</a></li>
<li class="chapter" data-level="2.3.3" data-path="vis-basics.html"><a href="vis-basics.html#discrete-x-and-y"><i class="fa fa-check"></i><b>2.3.3</b> Discrete X and Y</a></li>
</ul>
</li>
<li class="chapter" data-level="2.4" data-path="vis-basics.html">
<a href="vis-basics.html#one-variable-plots"><i class="fa fa-check"></i><b>2.4</b> One variable plots</a><ul>
<li class="chapter" data-level="2.4.1" data-path="vis-basics.html"><a href="vis-basics.html#continuous-variables"><i class="fa fa-check"></i><b>2.4.1</b> Continuous variables</a></li>
<li class="chapter" data-level="2.4.2" data-path="vis-basics.html"><a href="vis-basics.html#discrete-variables"><i class="fa fa-check"></i><b>2.4.2</b> Discrete variables</a></li>
</ul>
</li>
<li class="chapter" data-level="2.5" data-path="vis-basics.html">
<a href="vis-basics.html#colors-and-shape"><i class="fa fa-check"></i><b>2.5</b> Colors and shape</a><ul>
<li class="chapter" data-level="2.5.1" data-path="vis-basics.html"><a href="vis-basics.html#static-colors"><i class="fa fa-check"></i><b>2.5.1</b> Static colors</a></li>
<li class="chapter" data-level="2.5.2" data-path="vis-basics.html"><a href="vis-basics.html#dynamic-colors"><i class="fa fa-check"></i><b>2.5.2</b> Dynamic colors</a></li>
<li class="chapter" data-level="2.5.3" data-path="vis-basics.html"><a href="vis-basics.html#shape"><i class="fa fa-check"></i><b>2.5.3</b> Shape</a></li>
<li class="chapter" data-level="2.5.4" data-path="vis-basics.html"><a href="vis-basics.html#combining-color-and-shape"><i class="fa fa-check"></i><b>2.5.4</b> Combining color and shape</a></li>
<li class="chapter" data-level="2.5.5" data-path="vis-basics.html"><a href="vis-basics.html#transparency"><i class="fa fa-check"></i><b>2.5.5</b> Transparency</a></li>
<li class="chapter" data-level="2.5.6" data-path="vis-basics.html"><a href="vis-basics.html#what-can-go-wrong"><i class="fa fa-check"></i><b>2.5.6</b> What can go wrong</a></li>
</ul>
</li>
<li class="chapter" data-level="2.6" data-path="vis-basics.html"><a href="vis-basics.html#labels"><i class="fa fa-check"></i><b>2.6</b> Labels</a></li>
<li class="chapter" data-level="2.7" data-path="vis-basics.html"><a href="vis-basics.html#themes"><i class="fa fa-check"></i><b>2.7</b> Themes</a></li>
<li class="chapter" data-level="2.8" data-path="vis-basics.html">
<a href="vis-basics.html#scales"><i class="fa fa-check"></i><b>2.8</b> Scales</a><ul>
<li class="chapter" data-level="2.8.1" data-path="vis-basics.html"><a href="vis-basics.html#labs"><i class="fa fa-check"></i><b>2.8.1</b> <code>labs()</code></a></li>
<li class="chapter" data-level="2.8.2" data-path="vis-basics.html"><a href="vis-basics.html#axes"><i class="fa fa-check"></i><b>2.8.2</b> Axes</a></li>
<li class="chapter" data-level="2.8.3" data-path="vis-basics.html"><a href="vis-basics.html#color-scale"><i class="fa fa-check"></i><b>2.8.3</b> Color scale</a></li>
</ul>
</li>
<li class="chapter" data-level="2.9" data-path="vis-basics.html">
<a href="vis-basics.html#export-saving"><i class="fa fa-check"></i><b>2.9</b> Export &amp; saving</a><ul>
<li class="chapter" data-level="2.9.1" data-path="vis-basics.html"><a href="vis-basics.html#base-r-vs.-ggplot2"><i class="fa fa-check"></i><b>2.9.1</b> Base R vs. {{ggplot2}}</a></li>
<li class="chapter" data-level="2.9.2" data-path="vis-basics.html"><a href="vis-basics.html#storing-the-plot-as-an-r-object"><i class="fa fa-check"></i><b>2.9.2</b> Storing the plot as an R object</a></li>
<li class="chapter" data-level="2.9.3" data-path="vis-basics.html"><a href="vis-basics.html#best-practices-for-exporting"><i class="fa fa-check"></i><b>2.9.3</b> Best practices for exporting</a></li>
</ul>
</li>
<li class="chapter" data-level="2.10" data-path="vis-basics.html">
<a href="vis-basics.html#facetting"><i class="fa fa-check"></i><b>2.10</b> Facetting</a><ul>
<li class="chapter" data-level="2.10.1" data-path="vis-basics.html"><a href="vis-basics.html#facet_wrap"><i class="fa fa-check"></i><b>2.10.1</b> <code>facet_wrap()</code></a></li>
<li class="chapter" data-level="2.10.2" data-path="vis-basics.html"><a href="vis-basics.html#facet_grid"><i class="fa fa-check"></i><b>2.10.2</b> <code>facet_grid()</code></a></li>
<li class="chapter" data-level="2.10.3" data-path="vis-basics.html"><a href="vis-basics.html#scales-1"><i class="fa fa-check"></i><b>2.10.3</b> Scales</a></li>
<li class="chapter" data-level="2.10.4" data-path="vis-basics.html"><a href="vis-basics.html#renaming-of-facet-labels"><i class="fa fa-check"></i><b>2.10.4</b> Renaming of facet labels</a></li>
</ul>
</li>
<li class="chapter" data-level="2.11" data-path="vis-basics.html">
<a href="vis-basics.html#extensions"><i class="fa fa-check"></i><b>2.11</b> Extensions</a><ul>
<li class="chapter" data-level="2.11.1" data-path="vis-basics.html"><a href="vis-basics.html#ggsci"><i class="fa fa-check"></i><b>2.11.1</b> {ggsci}</a></li>
<li class="chapter" data-level="2.11.2" data-path="vis-basics.html"><a href="vis-basics.html#ggforce"><i class="fa fa-check"></i><b>2.11.2</b> {ggforce}</a></li>
<li class="chapter" data-level="2.11.3" data-path="vis-basics.html"><a href="vis-basics.html#gganimate-1"><i class="fa fa-check"></i><b>2.11.3</b> {gganimate}</a></li>
<li class="chapter" data-level="2.11.4" data-path="vis-basics.html"><a href="vis-basics.html#ggtext"><i class="fa fa-check"></i><b>2.11.4</b> {ggtext}</a></li>
<li class="chapter" data-level="2.11.5" data-path="vis-basics.html"><a href="vis-basics.html#ggrepel"><i class="fa fa-check"></i><b>2.11.5</b> {ggrepel}</a></li>
<li class="chapter" data-level="2.11.6" data-path="vis-basics.html"><a href="vis-basics.html#ggiraph"><i class="fa fa-check"></i><b>2.11.6</b> {ggiraph}</a></li>
<li class="chapter" data-level="2.11.7" data-path="vis-basics.html"><a href="vis-basics.html#ggbeeswarm"><i class="fa fa-check"></i><b>2.11.7</b> {ggbeeswarm}</a></li>
<li class="chapter" data-level="2.11.8" data-path="vis-basics.html"><a href="vis-basics.html#ggpmisc"><i class="fa fa-check"></i><b>2.11.8</b> {ggpmisc}</a></li>
<li class="chapter" data-level="2.11.9" data-path="vis-basics.html"><a href="vis-basics.html#esquisse"><i class="fa fa-check"></i><b>2.11.9</b> {esquisse}</a></li>
</ul>
</li>
</ul>
</li>
<li class="chapter" data-level="3" data-path="transformation.html">
<a href="transformation.html"><i class="fa fa-check"></i><b>3</b> Transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="transformation.html"><a href="transformation.html#package-conflicted"><i class="fa fa-check"></i><b>3.1</b> Package: {conflicted}</a></li>
<li class="chapter" data-level="3.2" data-path="transformation.html">
<a href="transformation.html#filtering"><i class="fa fa-check"></i><b>3.2</b> Filtering</a><ul>
<li class="chapter" data-level="" data-path="transformation.html"><a href="transformation.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul>
</li>
<li class="chapter" data-level="3.3" data-path="transformation.html">
<a href="transformation.html#sorting"><i class="fa fa-check"></i><b>3.3</b> Sorting</a><ul>
<li class="chapter" data-level="" data-path="transformation.html"><a href="transformation.html#exercises-1"><i class="fa fa-check"></i>Exercises</a></li>
</ul>
</li>
<li class="chapter" data-level="3.4" data-path="transformation.html">
<a href="transformation.html#the-pipe"><i class="fa fa-check"></i><b>3.4</b> The pipe</a><ul>
<li class="chapter" data-level="3.4.1" data-path="transformation.html"><a href="transformation.html#further-advantages"><i class="fa fa-check"></i><b>3.4.1</b> Further advantages</a></li>
<li class="chapter" data-level="" data-path="transformation.html"><a href="transformation.html#exercises-2"><i class="fa fa-check"></i>Exercises</a></li>
</ul>
</li>
<li class="chapter" data-level="3.5" data-path="transformation.html">
<a href="transformation.html#pick-columns"><i class="fa fa-check"></i><b>3.5</b> Pick columns</a><ul>
<li class="chapter" data-level="" data-path="transformation.html"><a href="transformation.html#exercises-3"><i class="fa fa-check"></i>Exercises</a></li>
</ul>
</li>
<li class="chapter" data-level="3.6" data-path="transformation.html">
<a href="transformation.html#create-new-columns"><i class="fa fa-check"></i><b>3.6</b> Create new columns</a><ul>
<li class="chapter" data-level="" data-path="transformation.html"><a href="transformation.html#exercises-4"><i class="fa fa-check"></i>Exercises</a></li>
</ul>
</li>
<li class="chapter" data-level="3.7" data-path="transformation.html">
<a href="transformation.html#summarize-data"><i class="fa fa-check"></i><b>3.7</b> Summarize data</a><ul>
<li class="chapter" data-level="" data-path="transformation.html"><a href="transformation.html#exercises-5"><i class="fa fa-check"></i>Exercises</a></li>
</ul>
</li>
<li class="chapter" data-level="3.8" data-path="transformation.html"><a href="transformation.html#summary-plots"><i class="fa fa-check"></i><b>3.8</b> Summary-plots</a></li>
</ul>
</li>
<li class="chapter" data-level="4" data-path="import.html">
<a href="import.html"><i class="fa fa-check"></i><b>4</b> Import</a><ul>
<li class="chapter" data-level="4.1" data-path="import.html">
<a href="import.html#import-single-files"><i class="fa fa-check"></i><b>4.1</b> Import single files</a><ul>
<li class="chapter" data-level="" data-path="import.html"><a href="import.html#exercises-6"><i class="fa fa-check"></i>Exercises</a></li>
</ul>
</li>
<li class="chapter" data-level="4.2" data-path="import.html">
<a href="import.html#import-many-files"><i class="fa fa-check"></i><b>4.2</b> Import many files</a><ul>
<li class="chapter" data-level="" data-path="import.html"><a href="import.html#exercises-7"><i class="fa fa-check"></i>Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="chapter" data-level="5" data-path="tidying.html">
<a href="tidying.html"><i class="fa fa-check"></i><b>5</b> Tidying</a><ul>
<li class="chapter" data-level="5.1" data-path="tidying.html">
<a href="tidying.html#pivoting"><i class="fa fa-check"></i><b>5.1</b> Pivoting</a><ul>
<li class="chapter" data-level="5.1.1" data-path="tidying.html"><a href="tidying.html#convert-to-longer-form"><i class="fa fa-check"></i><b>5.1.1</b> Convert to longer form</a></li>
<li class="chapter" data-level="5.1.2" data-path="tidying.html"><a href="tidying.html#convert-to-wider-form"><i class="fa fa-check"></i><b>5.1.2</b> Convert to wider form</a></li>
<li class="chapter" data-level="5.1.3" data-path="tidying.html"><a href="tidying.html#use-cases"><i class="fa fa-check"></i><b>5.1.3</b> Use cases</a></li>
<li class="chapter" data-level="5.1.4" data-path="tidying.html"><a href="tidying.html#combining-vertically"><i class="fa fa-check"></i><b>5.1.4</b> Combining vertically</a></li>
<li class="chapter" data-level="5.1.5" data-path="tidying.html"><a href="tidying.html#tidy-data"><i class="fa fa-check"></i><b>5.1.5</b> Tidy data</a></li>
</ul>
</li>
<li class="chapter" data-level="5.2" data-path="tidying.html">
<a href="tidying.html#separating-and-uniting"><i class="fa fa-check"></i><b>5.2</b> Separating and uniting</a><ul>
<li class="chapter" data-level="5.2.1" data-path="tidying.html"><a href="tidying.html#parsing-numbers"><i class="fa fa-check"></i><b>5.2.1</b> Parsing numbers</a></li>
</ul>
</li>
<li class="chapter" data-level="5.3" data-path="tidying.html"><a href="tidying.html#section"><i class="fa fa-check"></i><b>5.3</b> <no caption defined></no></a></li>
</ul>
</li>
<li class="chapter" data-level="6" data-path="reporting.html">
<a href="reporting.html"><i class="fa fa-check"></i><b>6</b> Reporting</a><ul>
<li class="chapter" data-level="6.1" data-path="reporting.html"><a href="reporting.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="reporting.html"><a href="reporting.html#the-yaml-header"><i class="fa fa-check"></i><b>6.2</b> The YAML header</a></li>
<li class="chapter" data-level="6.3" data-path="reporting.html">
<a href="reporting.html#literate-programming-in-r"><i class="fa fa-check"></i><b>6.3</b> Literate programming in R</a><ul>
<li class="chapter" data-level="6.3.1" data-path="reporting.html"><a href="reporting.html#r-markdown-packages"><i class="fa fa-check"></i><b>6.3.1</b> R Markdown packages</a></li>
<li class="chapter" data-level="6.3.2" data-path="reporting.html"><a href="reporting.html#code-chunks-in-r-markdown"><i class="fa fa-check"></i><b>6.3.2</b> Code chunks in R Markdown</a></li>
<li class="chapter" data-level="6.3.3" data-path="reporting.html"><a href="reporting.html#r-notebooks"><i class="fa fa-check"></i><b>6.3.3</b> R Notebooks</a></li>
<li class="chapter" data-level="6.3.4" data-path="reporting.html"><a href="reporting.html#workflow"><i class="fa fa-check"></i><b>6.3.4</b> Workflow</a></li>
</ul>
</li>
<li class="chapter" data-level="6.4" data-path="reporting.html"><a href="reporting.html#shiny-interactive-visualizations"><i class="fa fa-check"></i><b>6.4</b> Shiny: Interactive visualizations</a></li>
</ul>
</li>
<li class="chapter" data-level="7" data-path="appendix-best-practices.html">
<a href="appendix-best-practices.html"><i class="fa fa-check"></i><b>7</b> Appendix: Best practices</a><ul>
<li class="chapter" data-level="7.1" data-path="appendix-best-practices.html"><a href="appendix-best-practices.html#description"><i class="fa fa-check"></i><b>7.1</b> DESCRIPTION</a></li>
<li class="chapter" data-level="7.2" data-path="appendix-best-practices.html"><a href="appendix-best-practices.html#r"><i class="fa fa-check"></i><b>7.2</b> R</a></li>
<li class="chapter" data-level="7.3" data-path="appendix-best-practices.html"><a href="appendix-best-practices.html#roxygen2"><i class="fa fa-check"></i><b>7.3</b> roxygen2</a></li>
<li class="chapter" data-level="7.4" data-path="appendix-best-practices.html"><a href="appendix-best-practices.html#testthat"><i class="fa fa-check"></i><b>7.4</b> testthat</a></li>
</ul>
</li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul></nav>
</div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualization, transformation and reporting with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-"><div id="transformation" class="section level1">
<h1>
<span class="header-section-number">3</span> Transformation</h1>
<blockquote>
<p>Using a consistent grammar of data manipulation.</p>
</blockquote>
<p>This chapter discusses data transformation with the <a href="https://dplyr.tidyverse.org/">dplyr package</a>.</p>
<ul>
<li>One table:
<ul>
<li><code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code></li>
<li><code>select()</code></li>
<li><code>arrange()</code></li>
<li><code>mutate()</code></li>
<li><code>summarise()</code></li>
</ul>
</li>
<li>Grouped operations
<ul>
<li><code>group_by()</code></li>
<li><code>ungroup()</code></li>
</ul>
</li>
<li>Joins
<ul>
<li><code>xxx_join()</code></li>
</ul>
</li>
</ul>
<div id="package-conflicted" class="section level2">
<h2>
<span class="header-section-number">3.1</span> Package: {conflicted}</h2>
<details><p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb117-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(conflicted)</a>
<a class="sourceLine" id="cb117-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details><p>This section is dedicated to show you the basic building blocks (i.e. functions) of data analysis in R within the {tidyverse}.
The package providing these is {dplyr}.</p>
<p>Before starting, we would like to mention the package {conflicted}, which when loaded, will help detecting functions of the same name from different packages (an error is thrown in case of such situations).
It furthermore helps to resolve these situations, by allowing you to choose, the function of which package you prefer (<code><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflicted::conflict_prefer()</a></code>).
You can see an example in the setup code.</p>
</div>
<div id="filtering" class="section level2">
<h2>
<span class="header-section-number">3.2</span> Filtering</h2>
<details><p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</a>
<a class="sourceLine" id="cb120-3" data-line-number="3"></a>
<a class="sourceLine" id="cb120-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(conflicted)</a>
<a class="sourceLine" id="cb120-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details><p>During this lecture we will be working with data from the package {nycflights13}, which contains flights in the year 2013 with their departure in New York City (airports: JFK, LGA or EWR) to destinations in the United States, Puerto Rico, and the American Virgin Islands.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">flights</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      517            515         2      830
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      533            529         4      850
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      542            540         2      923
## </span><span style="color: #555555;"># … with 3.368e+05 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">?flights</a></code></pre></div>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> helps you to reduce your dataset to the observations (rows) of interest.
The filter condition can use any of the dataset’s variables and needs to be a logical expression.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 8,730 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      517            515         2      830
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      533            529         4      850
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      542            540         2      923
## </span><span style="color: #555555;"># … with 8,727 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>The following building blocks are frequently used in a filter:</p>
<ul>
<li>
<p>Operators: <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code>, <code><a href="https://rdrr.io/r/base/Comparison.html">!=</a></code>, <code><a href="https://rdrr.io/r/base/Comparison.html">&lt;</a></code>, <code><a href="https://rdrr.io/r/base/Comparison.html">&gt;</a></code>, <code><a href="https://rdrr.io/r/base/Comparison.html">&lt;=</a></code>, <code><a href="https://rdrr.io/r/base/Comparison.html">&gt;=</a></code></p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1">month <span class="op">==</span><span class="st"> </span><span class="dv">3</span>              <span class="co"># careful: two =</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2">month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb126-3" data-line-number="3">carrier <span class="op">!=</span><span class="st"> "UA"</span>         <span class="co"># careful: &lt;&gt; doesn't work</span></a>
<a class="sourceLine" id="cb126-4" data-line-number="4">arr_time <span class="op">&lt;</span><span class="st"> </span>dep_time</a></code></pre></div>
</li>
<li>
<p><code>near()</code></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="kw">near</span>(<span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(pi), <span class="dv">0</span>)</a></code></pre></div>
</li>
<li>
<p><code>between()</code>, <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="kw">between</span>(hour, <span class="dv">8</span>, <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb128-2" data-line-number="2">month <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>)</a></code></pre></div>
</li>
<li><p><code>str_detect()</code> for strings</p></li>
</ul>
<p>Missing values can be detected with <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code>:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(dep_time))</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 8,255 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1       </span><span style="color: #BB0000;">NA</span><span>           </span><span style="text-decoration: underline;">1</span><span>630        </span><span style="color: #BB0000;">NA</span><span>       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1       </span><span style="color: #BB0000;">NA</span><span>           </span><span style="text-decoration: underline;">1</span><span>935        </span><span style="color: #BB0000;">NA</span><span>       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1       </span><span style="color: #BB0000;">NA</span><span>           </span><span style="text-decoration: underline;">1</span><span>500        </span><span style="color: #BB0000;">NA</span><span>       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;"># … with 8,252 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(dep_time <span class="op">-</span><span class="st"> </span>arr_time))</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 8,713 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1     </span><span style="text-decoration: underline;">2</span><span>016           </span><span style="text-decoration: underline;">1</span><span>930        46       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1       </span><span style="color: #BB0000;">NA</span><span>           </span><span style="text-decoration: underline;">1</span><span>630        </span><span style="color: #BB0000;">NA</span><span>       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1       </span><span style="color: #BB0000;">NA</span><span>           </span><span style="text-decoration: underline;">1</span><span>935        </span><span style="color: #BB0000;">NA</span><span>       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;"># … with 8,710 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>Use <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> or multiple filters to return only rows that match both criteria:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span> <span class="op">&amp;</span><span class="st"> </span>arr_time <span class="op">&gt;</span><span class="st"> </span><span class="dv">2200</span>)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 0 x 19</span><span>
## </span><span style="color: #555555;"># … with 19 variables: </span><span style="color: #555555;font-weight: bold;">year</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">month</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">day</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">dep_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">sched_dep_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dep_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&gt;=</span><span class="st"> </span><span class="dv">700</span> <span class="op">&amp;</span><span class="st"> </span>arr_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">800</span>)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 10,654 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1     </span><span style="text-decoration: underline;">1</span><span>929           </span><span style="text-decoration: underline;">1</span><span>920         9        3
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1     </span><span style="text-decoration: underline;">1</span><span>939           </span><span style="text-decoration: underline;">1</span><span>840        59       29
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1     </span><span style="text-decoration: underline;">2</span><span>058           </span><span style="text-decoration: underline;">2</span><span>100        -</span><span style="color: #BB0000;">2</span><span>        8
## </span><span style="color: #555555;"># … with 1.065e+04 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&gt;=</span><span class="st"> </span><span class="dv">700</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(arr_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">800</span>)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 10,654 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1     </span><span style="text-decoration: underline;">1</span><span>929           </span><span style="text-decoration: underline;">1</span><span>920         9        3
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1     </span><span style="text-decoration: underline;">1</span><span>939           </span><span style="text-decoration: underline;">1</span><span>840        59       29
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1     </span><span style="text-decoration: underline;">2</span><span>058           </span><span style="text-decoration: underline;">2</span><span>100        -</span><span style="color: #BB0000;">2</span><span>        8
## </span><span style="color: #555555;"># … with 1.065e+04 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>Use <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> to return all rows that match either criterion or both:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span> <span class="op">|</span><span class="st"> </span>arr_time <span class="op">&gt;</span><span class="st"> </span><span class="dv">2200</span>)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 40,879 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      517            515         2      830
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      533            529         4      850
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      542            540         2      923
## </span><span style="color: #555555;"># … with 4.088e+04 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<div id="exercises" class="section level3 unnumbered">
<h3>Exercises</h3>
<p><a href="https://krlmlr.github.io/vistransrep/2019-11-zhr/filtering.html" class="uri">https://krlmlr.github.io/vistransrep/2019-11-zhr/filtering.html</a></p>
<p><a href="https://krlmlr.github.io/vistransrep/2019-11-zhr/filter-combine.html" class="uri">https://krlmlr.github.io/vistransrep/2019-11-zhr/filter-combine.html</a></p>
</div>
</div>
<div id="sorting" class="section level2">
<h2>
<span class="header-section-number">3.3</span> Sorting</h2>
<details><p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</a>
<a class="sourceLine" id="cb135-3" data-line-number="3"></a>
<a class="sourceLine" id="cb135-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(conflicted)</a>
<a class="sourceLine" id="cb135-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details><p>The function <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">dplyr::arrange()</a></code> sorts the rows of the dataset according to the values of the variable(s) you are providing.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb138-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(dep_time)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1    13        1           </span><span style="text-decoration: underline;">2</span><span>249        72      108
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1    31        1           </span><span style="text-decoration: underline;">2</span><span>100       181      124
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    11    13        1           </span><span style="text-decoration: underline;">2</span><span>359         2      442
## </span><span style="color: #555555;"># … with 3.368e+05 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>When providing multiple variables as arguments for <code>...</code> (the ellipsis), the dataset is first sorted accorcing to the values of the first variable.
Wherever these values occur more than once, another sorting takes place within those groups, according to the second variable you provided.
The same rule applies for every further variable you add to <code>arrange()</code>.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(dep_time, dep_delay)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    11    13        1           </span><span style="text-decoration: underline;">2</span><span>359         2      442
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    16        1           </span><span style="text-decoration: underline;">2</span><span>359         2      447
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    20        1           </span><span style="text-decoration: underline;">2</span><span>359         2      430
## </span><span style="color: #555555;"># … with 3.368e+05 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>You can combine <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> and <code>arrange()</code>.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(dep_time, dep_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1,894 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    11    13        1           </span><span style="text-decoration: underline;">2</span><span>359         2      442
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    16        1           </span><span style="text-decoration: underline;">2</span><span>359         2      447
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    20        1           </span><span style="text-decoration: underline;">2</span><span>359         2      430
## </span><span style="color: #555555;"># … with 1,891 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>You can use <code>arrange()</code> with arbitrary expressions.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 970 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1      454            500        -</span><span style="color: #BB0000;">6</span><span>      636
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1      509            515        -</span><span style="color: #BB0000;">6</span><span>      743
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1      526            530        -</span><span style="color: #BB0000;">4</span><span>      812
## </span><span style="color: #555555;"># … with 967 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>The reason for the result you just saw in the view of the filtered dataset is, that the binary result of the expression (<code>TRUE</code>, <code>FALSE</code>) is sorted <code>FALSE</code> first (lexicographically).</p>
<p>Let’s give it a twist:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 970 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1       </span><span style="color: #BB0000;">NA</span><span>           </span><span style="text-decoration: underline;">1</span><span>125        </span><span style="color: #BB0000;">NA</span><span>       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1       </span><span style="color: #BB0000;">NA</span><span>           </span><span style="text-decoration: underline;">1</span><span>545        </span><span style="color: #BB0000;">NA</span><span>       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1       </span><span style="color: #BB0000;">NA</span><span>            850        </span><span style="color: #BB0000;">NA</span><span>       </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;"># … with 967 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>Sorting the dataset according to which flights arrived earliest on April 1, 2013:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb143-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb143-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb143-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 970 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>243           </span><span style="text-decoration: underline;">2</span><span>245        -</span><span style="color: #BB0000;">2</span><span>        6
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>056           </span><span style="text-decoration: underline;">1</span><span>925        91        8
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>216           </span><span style="text-decoration: underline;">2</span><span>100        76        9
## </span><span style="color: #555555;"># … with 967 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>Invert the sorting by either…</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 970 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>027           </span><span style="text-decoration: underline;">2</span><span>032        -</span><span style="color: #BB0000;">5</span><span>     </span><span style="text-decoration: underline;">2</span><span>358
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>151           </span><span style="text-decoration: underline;">1</span><span>930       141     </span><span style="text-decoration: underline;">2</span><span>358
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>252           </span><span style="text-decoration: underline;">2</span><span>245         7     </span><span style="text-decoration: underline;">2</span><span>358
## </span><span style="color: #555555;"># … with 967 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>… or:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 970 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>027           </span><span style="text-decoration: underline;">2</span><span>032        -</span><span style="color: #BB0000;">5</span><span>     </span><span style="text-decoration: underline;">2</span><span>358
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>151           </span><span style="text-decoration: underline;">1</span><span>930       141     </span><span style="text-decoration: underline;">2</span><span>358
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1     </span><span style="text-decoration: underline;">2</span><span>252           </span><span style="text-decoration: underline;">2</span><span>245         7     </span><span style="text-decoration: underline;">2</span><span>358
## </span><span style="color: #555555;"># … with 967 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>You can mix sorting in an ascending and a descending manner:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(dep_time, <span class="kw">desc</span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 970 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1      454            500        -</span><span style="color: #BB0000;">6</span><span>      636
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1      509            515        -</span><span style="color: #BB0000;">6</span><span>      743
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     4     1      526            530        -</span><span style="color: #BB0000;">4</span><span>      812
## </span><span style="color: #555555;"># … with 967 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<div id="exercises-1" class="section level3 unnumbered">
<h3>Exercises</h3>
<p><a href="https://krlmlr.github.io/vistransrep/2019-11-zhr/arrange.html" class="uri">https://krlmlr.github.io/vistransrep/2019-11-zhr/arrange.html</a></p>
</div>
</div>
<div id="the-pipe" class="section level2">
<h2>
<span class="header-section-number">3.4</span> The pipe</h2>
<details><p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb147-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</a>
<a class="sourceLine" id="cb147-3" data-line-number="3"></a>
<a class="sourceLine" id="cb147-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(conflicted)</a>
<a class="sourceLine" id="cb147-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details><p>We already heavily used it today, but what exactly are the characteristics of <code>%&gt;%</code>, better known as “the pipe”?</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">early_flights &lt;-</a>
<a class="sourceLine" id="cb150-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a></code></pre></div>
<p>The above is just another way of writing:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1">early_flights &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(flights, dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a></code></pre></div>
<p>The manual describes this operator in detail:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">?<span class="st">"%&gt;%"</span></a></code></pre></div>
<p>With the pipe, code can be read in a natural way, from left to right.
The following snippet extracts</p>
<ol style="list-style-type: decimal">
<li>all early flights</li>
<li>from October till December,</li>
<li>ordered by departure time and then departure delay</li>
<li>and displays it.</li>
</ol>
<p>Note how the reading corresponds to the code.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(dep_time, dep_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb153-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1,894 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    11    13        1           </span><span style="text-decoration: underline;">2</span><span>359         2      442
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    16        1           </span><span style="text-decoration: underline;">2</span><span>359         2      447
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    20        1           </span><span style="text-decoration: underline;">2</span><span>359         2      430
## </span><span style="color: #555555;"># … with 1,891 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>This is possible, because all transformation verbs (<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, <code>arrange()</code>, <code>view()</code>) accept the main input (a tibble) as the first argument and also return a tibble.</p>
<p>The following three codes are equivalent, but are more difficult to write, to read and to maintain.</p>
<p>Naming is hard.
Trying to give each intermediate result a name is exhausting.
Introducing an additional step in this sequence of operations is prone to errors.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">early_flights &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(flights, dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a>
<a class="sourceLine" id="cb154-2" data-line-number="2">early_flights_oct_dec &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(early_flights, month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb154-3" data-line-number="3">early_flights_oct_dec_sorted &lt;-<span class="st"> </span><span class="kw">arrange</span>(early_flights_oct_dec, dep_time, dep_delay)</a>
<a class="sourceLine" id="cb154-4" data-line-number="4"><span class="kw">view</span>(early_flights_oct_dec_sorted)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1,894 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    11    13        1           </span><span style="text-decoration: underline;">2</span><span>359         2      442
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    16        1           </span><span style="text-decoration: underline;">2</span><span>359         2      447
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    20        1           </span><span style="text-decoration: underline;">2</span><span>359         2      430
## </span><span style="color: #555555;"># … with 1,891 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>We can keep using the same variable, e.g. <code>x</code>, to avoid naming.
This adds noise compared to the pipe.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1">x &lt;-<span class="st"> </span>flights</a>
<a class="sourceLine" id="cb155-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(x, dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>)</a>
<a class="sourceLine" id="cb155-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(x, month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb155-4" data-line-number="4">x &lt;-<span class="st"> </span><span class="kw">arrange</span>(x, dep_time, dep_delay)</a>
<a class="sourceLine" id="cb155-5" data-line-number="5"><span class="kw">view</span>(x)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1,894 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    11    13        1           </span><span style="text-decoration: underline;">2</span><span>359         2      442
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    16        1           </span><span style="text-decoration: underline;">2</span><span>359         2      447
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    20        1           </span><span style="text-decoration: underline;">2</span><span>359         2      430
## </span><span style="color: #555555;"># … with 1,891 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>We can avoid intermediate variables.
This disconnects the verbs from their arguments and is very difficult to read.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="kw">view</span>(</a>
<a class="sourceLine" id="cb156-2" data-line-number="2">  <span class="kw">arrange</span>(</a>
<a class="sourceLine" id="cb156-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb156-4" data-line-number="4">      <span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb156-5" data-line-number="5">        flights,</a>
<a class="sourceLine" id="cb156-6" data-line-number="6">        dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span></a>
<a class="sourceLine" id="cb156-7" data-line-number="7">      ),</a>
<a class="sourceLine" id="cb156-8" data-line-number="8">      month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb156-9" data-line-number="9">    ),</a>
<a class="sourceLine" id="cb156-10" data-line-number="10">    dep_time, dep_delay</a>
<a class="sourceLine" id="cb156-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb156-12" data-line-number="12">)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1,894 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    11    13        1           </span><span style="text-decoration: underline;">2</span><span>359         2      442
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    16        1           </span><span style="text-decoration: underline;">2</span><span>359         2      447
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    12    20        1           </span><span style="text-decoration: underline;">2</span><span>359         2      430
## </span><span style="color: #555555;"># … with 1,891 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<div id="further-advantages" class="section level3">
<h3>
<span class="header-section-number">3.4.1</span> Further advantages</h3>
<p>When working on a code chunk consisting of subsequent transformations connected by pipes, it can be useful to end the pipeline with either <code>I</code> or <code>view()</code>.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">600</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>I</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1,894 x 19</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
## </span><span style="color: #555555;">*</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    10     1      447            500       -</span><span style="color: #BB0000;">13</span><span>      614
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    10     1      522            517         5      735
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013    10     1      536            545        -</span><span style="color: #BB0000;">9</span><span>      809
## </span><span style="color: #555555;"># … with 1,891 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">##arrange(dep_time, dep_delay) %&gt;%</a>
<a class="sourceLine" id="cb158-2" data-line-number="2">##view()</a></code></pre></div>
<p>Once the chunk does what you expect it to do, do not forget to remove the <code>I</code> or <code>view()</code> call.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(</a>
<a class="sourceLine" id="cb159-2" data-line-number="2">  <span class="kw">arrange</span>(dep_time, dep_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-3" data-line-number="3"><span class="st">  </span><span class="kw">view</span>()</a>
<a class="sourceLine" id="cb159-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## Error in arrange(dep_time, dep_delay) : object 'dep_time' not found</code></pre>
<p>To rearrange rows, you can use the shortcut <code>Alt + Cursor up/down</code>.
In a piped expression, no further editing is necessary!</p>
</div>
<div id="exercises-2" class="section level3 unnumbered">
<h3>Exercises</h3>
<p><a href="https://krlmlr.github.io/vistransrep/2019-11-zhr/pipe.html" class="uri">https://krlmlr.github.io/vistransrep/2019-11-zhr/pipe.html</a></p>
</div>
</div>
<div id="pick-columns" class="section level2">
<h2>
<span class="header-section-number">3.5</span> Pick columns</h2>
<details><p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb161-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</a>
<a class="sourceLine" id="cb161-3" data-line-number="3"></a>
<a class="sourceLine" id="cb161-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(conflicted)</a>
<a class="sourceLine" id="cb161-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
</details><p>With <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code> you can (de-)select and/or rename columns of your dataset.
The basic operation is like in the following examples:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year, month, day)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 3</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1
## </span><span style="color: #555555;"># … with 3.368e+05 more rows</span><span>
</span></code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>year)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 18</span><span>
##   </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>     1     1      517            515         2      830
## </span><span style="color: #555555;">2</span><span>     1     1      533            529         4      850
## </span><span style="color: #555555;">3</span><span>     1     1      542            540         2      923
## </span><span style="color: #555555;"># … with 3.368e+05 more rows, and 12 more variables:
## #   </span><span style="color: #555555;font-weight: bold;">sched_arr_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">arr_delay</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">carrier</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">flight</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">tailnum</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">origin</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">dest</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">distance</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">, </span><span style="color: #555555;font-weight: bold;">minute</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span style="color: #555555;">,
## #   </span><span style="color: #555555;font-weight: bold;">time_hour</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>
</span></code></pre>
<p>Renaming works by addressing an existing column on the right hand side of an equality sign and providing the new name of the column on its left hand side.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb166-3" data-line-number="3">    year, month, day,</a>
<a class="sourceLine" id="cb166-4" data-line-number="4">    <span class="dt">departure_delay =</span> dep_delay,</a>
<a class="sourceLine" id="cb166-5" data-line-number="5">    <span class="dt">arrival_delay =</span> arr_delay</a>
<a class="sourceLine" id="cb166-6" data-line-number="6">  )</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 5</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">departure_delay</span><span> </span><span style="font-weight: bold;">arrival_delay</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>         </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1               2            11
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1               4            20
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1               2            33
## </span><span style="color: #555555;"># … with 3.368e+05 more rows</span><span>
</span></code></pre>
<p>With backticks, it is possible, but not advised, to use arbitrary characters (including spaces) in column names:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1">flights_with_spaces &lt;-</a>
<a class="sourceLine" id="cb167-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb167-4" data-line-number="4">    year, month, day,</a>
<a class="sourceLine" id="cb167-5" data-line-number="5">    <span class="st">`</span><span class="dt">Departure delay</span><span class="st">`</span> =<span class="st"> </span>dep_delay,</a>
<a class="sourceLine" id="cb167-6" data-line-number="6">    <span class="st">`</span><span class="dt">Arrival delay</span><span class="st">`</span> =<span class="st"> </span>arr_delay</a>
<a class="sourceLine" id="cb167-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb167-9" data-line-number="9">    <span class="st">`</span><span class="dt">Arrival delay</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb167-10" data-line-number="10">  )</a></code></pre></div>
<p>Address them in the same way, if the dataset already has such variables:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">flights_with_spaces <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb168-3" data-line-number="3">    year, month, day,</a>
<a class="sourceLine" id="cb168-4" data-line-number="4">    <span class="dt">dep_delay =</span> <span class="st">`</span><span class="dt">Departure delay</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb168-5" data-line-number="5">    <span class="dt">arr_delay =</span> <span class="st">`</span><span class="dt">Arrival delay</span><span class="st">`</span></a>
<a class="sourceLine" id="cb168-6" data-line-number="6">  )</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 188,933 x 5</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_delay</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1        -</span><span style="color: #BB0000;">1</span><span>       -</span><span style="color: #BB0000;">18</span><span>
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1        -</span><span style="color: #BB0000;">6</span><span>       -</span><span style="color: #BB0000;">25</span><span>
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1        -</span><span style="color: #BB0000;">3</span><span>       -</span><span style="color: #BB0000;">14</span><span>
## </span><span style="color: #555555;"># … with 1.889e+05 more rows</span><span>
</span></code></pre>
<p>The {janitor} package helps fixing issues with colum names automatically.</p>
<p>Select helpers allow selecting multiple related columns conveniently:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb169-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(origin, dest, <span class="kw">ends_with</span>(<span class="st">"_time"</span>))</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 7</span><span>
##   </span><span style="font-weight: bold;">origin</span><span> </span><span style="font-weight: bold;">dest</span><span>  </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">sched_dep_time</span><span> </span><span style="font-weight: bold;">arr_time</span><span> </span><span style="font-weight: bold;">sched_arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span> EWR    IAH        517            515      830            819
## </span><span style="color: #555555;">2</span><span> LGA    IAH        533            529      850            830
## </span><span style="color: #555555;">3</span><span> JFK    MIA        542            540      923            850
## </span><span style="color: #555555;"># … with 3.368e+05 more rows, and 1 more variable:
## #   </span><span style="color: #555555;font-weight: bold;">air_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
</span></code></pre>
<div id="exercises-3" class="section level3 unnumbered">
<h3>Exercises</h3>
<p><a href="https://krlmlr.github.io/vistransrep/2019-11-zhr/select-rename.html" class="uri">https://krlmlr.github.io/vistransrep/2019-11-zhr/select-rename.html</a></p>
</div>
</div>
<div id="create-new-columns" class="section level2">
<h2>
<span class="header-section-number">3.6</span> Create new columns</h2>
<details><p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</a>
<a class="sourceLine" id="cb170-3" data-line-number="3"></a>
<a class="sourceLine" id="cb170-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(conflicted)</a>
<a class="sourceLine" id="cb170-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
</details><p>With <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code> you can add new columns to a table, e.g. making use of the already existing variables.
This is another building block added to the toolset.</p>
<p>How much faster than the scheduled time did the pilots manage to fly:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb176-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recovery =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb176-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(dep_delay, arr_delay, recovery)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 3</span><span>
##   </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_delay</span><span> </span><span style="font-weight: bold;">recovery</span><span>
##       </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>         2        11       -</span><span style="color: #BB0000;">9</span><span>
## </span><span style="color: #555555;">2</span><span>         4        20      -</span><span style="color: #BB0000;">16</span><span>
## </span><span style="color: #555555;">3</span><span>         2        33      -</span><span style="color: #BB0000;">31</span><span>
## </span><span style="color: #555555;"># … with 3.368e+05 more rows</span><span>
</span></code></pre>
<p>Conceptually, the expression that defines the new variable is evaluated for each row.</p>
<p>The following constructs are often applied inside <code>mutate()</code>:</p>
<ul>
<li>
<p>Arithmetic: <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">^</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></code></p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1">dep_delay <span class="op">-</span><span class="st"> </span>arr_delay</a>
<a class="sourceLine" id="cb177-2" data-line-number="2">dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb177-3" data-line-number="3">dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb177-4" data-line-number="4">dep_delay <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(dep_delay)   <span class="co"># Deviation from mean</span></a></code></pre></div>
</li>
<li>Real functions, see <code><a href="https://rdrr.io/r/base/groupGeneric.html">?base::Math</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">?dplyr::lead</a></code>:
<ul>
<li>Rounding: <code><a href="https://rdrr.io/r/base/Round.html">floor()</a></code>, <code><a href="https://rdrr.io/r/base/Round.html">ceiling()</a></code>, <code><a href="https://rdrr.io/r/base/Round.html">round()</a></code>
</li>
<li>Sign: <code><a href="https://rdrr.io/r/base/MathFun.html">abs()</a></code>, <code><a href="https://rdrr.io/r/base/sign.html">sign()</a></code>
</li>
<li>Transform: <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt()</a></code>, <code><a href="https://rdrr.io/r/base/Log.html">log()</a></code>, <code><a href="https://rdrr.io/r/base/Log.html">log2()</a></code>, <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code>
</li>
<li>Trigonometric: <code><a href="https://rdrr.io/r/base/Trig.html">sin()</a></code> etc.</li>
</ul>
</li>
<li><p>Recoding: <code>if_else()</code>, <code>case_when()</code>, <code>recode()</code></p></li>
<li><p>All filtering functions for a new <code>logical</code> column</p></li>
<li><p><code>str_replace()</code> for string columns</p></li>
<li>Functions that process values from other rows:
<ul>
<li>Cumulative: <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> etc.</li>
<li>Lead and lag: <code>lead()</code>, <code><a href="https://rdrr.io/r/stats/lag.html">lag()</a></code>
</li>
<li>Ranking: <code>row_number()</code>, <code>min_rank()</code>, <code>ntile()</code>
</li>
</ul>
</li>
</ul>
<p>Work with the newly created variables just like with the original ones:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recovery =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(dep_delay, arr_delay, recovery) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(recovery)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 3</span><span>
##   </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_delay</span><span> </span><span style="font-weight: bold;">recovery</span><span>
##       </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>        -</span><span style="color: #BB0000;">2</span><span>       194     -</span><span style="color: #BB0000;">196</span><span>
## </span><span style="color: #555555;">2</span><span>        -</span><span style="color: #BB0000;">2</span><span>       179     -</span><span style="color: #BB0000;">181</span><span>
## </span><span style="color: #555555;">3</span><span>       180       345     -</span><span style="color: #BB0000;">165</span><span>
## </span><span style="color: #555555;"># … with 3.368e+05 more rows</span><span>
</span></code></pre>
<p>A <code>mutate()</code> never changes a dataset.
To make a computation persistent, store the entire result as a new dataset variable.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span>(</a>
<a class="sourceLine" id="cb179-2" data-line-number="2">  flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb179-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(recovery)</a>
<a class="sourceLine" id="cb179-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## Error in .f(.x[[i]], ...) : object 'recovery' not found</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1">recovery_data &lt;-</a>
<a class="sourceLine" id="cb181-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recovery =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(dep_delay, arr_delay, recovery) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(recovery)</a>
<a class="sourceLine" id="cb181-6" data-line-number="6"></a>
<a class="sourceLine" id="cb181-7" data-line-number="7">recovery_data</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 3</span><span>
##   </span><span style="font-weight: bold;">dep_delay</span><span> </span><span style="font-weight: bold;">arr_delay</span><span> </span><span style="font-weight: bold;">recovery</span><span>
##       </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>        -</span><span style="color: #BB0000;">2</span><span>       194     -</span><span style="color: #BB0000;">196</span><span>
## </span><span style="color: #555555;">2</span><span>        -</span><span style="color: #BB0000;">2</span><span>       179     -</span><span style="color: #BB0000;">181</span><span>
## </span><span style="color: #555555;">3</span><span>       180       345     -</span><span style="color: #BB0000;">165</span><span>
## </span><span style="color: #555555;"># … with 3.368e+05 more rows</span><span>
</span></code></pre>
<p>Let’s look at a single airplane:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(tailnum <span class="op">==</span><span class="st"> "N14228"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-4" data-line-number="4"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 111 x 5</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      517      830
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     8     </span><span style="text-decoration: underline;">1</span><span>435     </span><span style="text-decoration: underline;">1</span><span>717
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     9      717      812
## </span><span style="color: #555555;"># … with 108 more rows</span><span>
</span></code></pre>
<p>Adding the departure time of the <em>next</em> flight to the current row, respectively, using <code>mutate()</code> with <code>lead()</code>:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb183-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(tailnum <span class="op">==</span><span class="st"> "N14228"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb183-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb183-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lead_dep_time =</span> <span class="kw">lead</span>(dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb183-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 111 x 6</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">arr_time</span><span> </span><span style="font-weight: bold;">lead_dep_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>         </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      517      830          </span><span style="text-decoration: underline;">1</span><span>435
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     8     </span><span style="text-decoration: underline;">1</span><span>435     </span><span style="text-decoration: underline;">1</span><span>717           717
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     9      717      812          </span><span style="text-decoration: underline;">1</span><span>143
## </span><span style="color: #555555;"># … with 108 more rows</span><span>
</span></code></pre>
<p>The opposite effect to <code>lead()</code> can be realized using <code><a href="https://rdrr.io/r/stats/lag.html">lag()</a></code>:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(tailnum <span class="op">==</span><span class="st"> "N14228"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_arr_time =</span> <span class="kw"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 111 x 6</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">arr_time</span><span> </span><span style="font-weight: bold;">lag_arr_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>        </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      517      830           </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     8     </span><span style="text-decoration: underline;">1</span><span>435     </span><span style="text-decoration: underline;">1</span><span>717          830
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     9      717      812         </span><span style="text-decoration: underline;">1</span><span>717
## </span><span style="color: #555555;"># … with 108 more rows</span><span>
</span></code></pre>
<p>There is even a use-case for this in our little example.
How long does it take for the airplane to return to NYC with each flight out?</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb185-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(tailnum <span class="op">==</span><span class="st"> "N14228"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb185-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, time_hour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb185-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_time_hour =</span> <span class="kw"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span>(time_hour)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb185-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ground_time =</span> time_hour <span class="op">-</span><span class="st"> </span>lag_time_hour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb185-6" data-line-number="6"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 111 x 6</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">time_hour</span><span>           </span><span style="font-weight: bold;">lag_time_hour</span><span>      
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>              </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>             
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1 2013-01-01 </span><span style="color: #555555;">05:00:00</span><span> </span><span style="color: #BB0000;">NA</span><span>                 
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     8 2013-01-08 </span><span style="color: #555555;">14:00:00</span><span> 2013-01-01 </span><span style="color: #555555;">05:00:00</span><span>
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     9 2013-01-09 </span><span style="color: #555555;">07:00:00</span><span> 2013-01-08 </span><span style="color: #555555;">14:00:00</span><span>
## </span><span style="color: #555555;"># … with 108 more rows, and 1 more variable:
## #   </span><span style="color: #555555;font-weight: bold;">ground_time</span><span style="color: #555555;"> </span><span style="color: #555555;font-style: italic;">&lt;drtn&gt;</span><span>
</span></code></pre>
<p>A frequently used workflow is creating a helper variable at some point in the pipeline and then dropping it later on:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(tailnum <span class="op">==</span><span class="st"> "N14228"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(year, month, day, dep_time, arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_arr_time =</span> <span class="kw"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ground_time =</span> dep_time <span class="op">-</span><span class="st"> </span>lag_arr_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lag_arr_time)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 111 x 6</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">dep_time</span><span> </span><span style="font-weight: bold;">arr_time</span><span> </span><span style="font-weight: bold;">ground_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>       </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1      517      830          </span><span style="color: #BB0000;">NA</span><span>
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     8     </span><span style="text-decoration: underline;">1</span><span>435     </span><span style="text-decoration: underline;">1</span><span>717         605
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     9      717      812       -</span><span style="color: #BB0000;text-decoration: underline;">1</span><span style="color: #BB0000;">000</span><span>
## </span><span style="color: #555555;"># … with 108 more rows</span><span>
</span></code></pre>
<p>Let’s work some more with the flight data of our special plane.
The total air time of a plane up to and including a given flight can be calculated with <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code>:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(tailnum <span class="op">==</span><span class="st"> "N14228"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(air_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(air_time, cum_air_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-5" data-line-number="5"><span class="st">  </span><span class="kw">view</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 111 x 2</span><span>
##   </span><span style="font-weight: bold;">air_time</span><span> </span><span style="font-weight: bold;">cum_air_time</span><span>
##      </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>        </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>      227          227
## </span><span style="color: #555555;">2</span><span>      150          377
## </span><span style="color: #555555;">3</span><span>       39          416
## </span><span style="color: #555555;"># … with 108 more rows</span><span>
</span></code></pre>
<p>Creating a “flag” variable with <code>mutate()</code> allows selecting if a flight was on time or not:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> <span class="kw">if_else</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">"delayed"</span>, <span class="st">"on time"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 2</span><span>
##   </span><span style="font-weight: bold;">arr_delay</span><span> </span><span style="font-weight: bold;">delayed</span><span>
##       </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  
## </span><span style="color: #555555;">1</span><span>        11 delayed
## </span><span style="color: #555555;">2</span><span>        20 delayed
## </span><span style="color: #555555;">3</span><span>        33 delayed
## </span><span style="color: #555555;"># … with 3.368e+05 more rows</span><span>
</span></code></pre>
<p>Shorter, but less verbose:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> (arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 2</span><span>
##   </span><span style="font-weight: bold;">arr_delay</span><span> </span><span style="font-weight: bold;">delayed</span><span>
##       </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>  
## </span><span style="color: #555555;">1</span><span>        11 TRUE   
## </span><span style="color: #555555;">2</span><span>        20 TRUE   
## </span><span style="color: #555555;">3</span><span>        33 TRUE   
## </span><span style="color: #555555;"># … with 3.368e+05 more rows</span><span>
</span></code></pre>
<p>A flag can be passed on to <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> directly:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(delayed)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 133,004 x 2</span><span>
##   </span><span style="font-weight: bold;">arr_delay</span><span> </span><span style="font-weight: bold;">delayed</span><span>
##       </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>  
## </span><span style="color: #555555;">1</span><span>        11 TRUE   
## </span><span style="color: #555555;">2</span><span>        20 TRUE   
## </span><span style="color: #555555;">3</span><span>        33 TRUE   
## </span><span style="color: #555555;"># … with 1.33e+05 more rows</span><span>
</span></code></pre>
<p>Use negation for inverse filtering, and store in a dataset variable for reuse:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1">on_time_flights &lt;-</a>
<a class="sourceLine" id="cb191-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delayed =</span> (arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(arr_delay, delayed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="op">!</span>delayed)</a>
<a class="sourceLine" id="cb191-6" data-line-number="6"></a>
<a class="sourceLine" id="cb191-7" data-line-number="7">on_time_flights</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 194,342 x 2</span><span>
##   </span><span style="font-weight: bold;">arr_delay</span><span> </span><span style="font-weight: bold;">delayed</span><span>
##       </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>  
## </span><span style="color: #555555;">1</span><span>       -</span><span style="color: #BB0000;">18</span><span> FALSE  
## </span><span style="color: #555555;">2</span><span>       -</span><span style="color: #BB0000;">25</span><span> FALSE  
## </span><span style="color: #555555;">3</span><span>       -</span><span style="color: #BB0000;">14</span><span> FALSE  
## </span><span style="color: #555555;"># … with 1.943e+05 more rows</span><span>
</span></code></pre>
<div id="exercises-4" class="section level3 unnumbered">
<h3>Exercises</h3>
<p><a href="https://krlmlr.github.io/vistransrep/2019-11-zhr/mutate.html" class="uri">https://krlmlr.github.io/vistransrep/2019-11-zhr/mutate.html</a></p>
</div>
</div>
<div id="summarize-data" class="section level2">
<h2>
<span class="header-section-number">3.7</span> Summarize data</h2>
<details><p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb192-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</a>
<a class="sourceLine" id="cb192-3" data-line-number="3"></a>
<a class="sourceLine" id="cb192-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(conflicted)</a>
<a class="sourceLine" id="cb192-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
</details><p>Often we want to draw just conclusions from larger datasets by gaining insight by using statistical (or other) methods for summarizing – and thus drastically reducing – the data:
How much time did all planes spend in the air?</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb198-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(air_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb198-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 336,776 x 2</span><span>
##   </span><span style="font-weight: bold;">air_time</span><span> </span><span style="font-weight: bold;">total_air_time</span><span>
##      </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>      227       49</span><span style="text-decoration: underline;">326</span><span>610
## </span><span style="color: #555555;">2</span><span>      227       49</span><span style="text-decoration: underline;">326</span><span>610
## </span><span style="color: #555555;">3</span><span>      160       49</span><span style="text-decoration: underline;">326</span><span>610
## </span><span style="color: #555555;"># … with 3.368e+05 more rows</span><span>
</span></code></pre>
<p>The <code>mutate()</code> call adds a new variable with the same value across all rows.
To reduce the result to a single row, use <code>summarize()</code>:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb199-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1 x 1</span><span>
##   </span><span style="font-weight: bold;">total_air_time</span><span>
##            </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>       49</span><span style="text-decoration: underline;">326</span><span>610
</span></code></pre>
<p>The following functions compute summary values:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, <code><a href="https://rdrr.io/r/base/prod.html">prod()</a></code>
<ul>
<li><code>na.rm = TRUE</code></li>
</ul>
</li>
<li>
<code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>
</li>
<li>
<code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>, <code><a href="https://rdrr.io/r/stats/IQR.html">IQR()</a></code>, <code><a href="https://rdrr.io/r/stats/mad.html">mad()</a></code>
</li>
<li>
<code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>, <code><a href="https://rdrr.io/r/stats/quantile.html">quantile(0.75)</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>
</li>
<li><p><code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> and <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> for <code>logical</code> variables:
<code>r   mean(is.na(arr_time))</code></p></li>
<li>Ranking
<ul>
<li><code>n()</code></li>
<li>
<code>first()</code>, <code>last()</code>, <code>nth()</code>
</li>
</ul>
</li>
</ul>
<p>Simple counts can be computed with <code>n()</code> inside <code>summarize()</code>:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1 x 1</span><span>
##        </span><span style="font-weight: bold;">n</span><span>
##    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span> </span><span style="text-decoration: underline;">336</span><span>776
</span></code></pre>
<p>A variety of aggregate functions is supported:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb201-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">median =</span> <span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1 x 1</span><span>
##   </span><span style="font-weight: bold;">median</span><span>
##    </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>    129
</span></code></pre>
<p>It’s possible to produce two different summarizations at once:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb202-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb202-3" data-line-number="3">    <span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb202-4" data-line-number="4">    <span class="dt">mean_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb202-5" data-line-number="5">    <span class="dt">median_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb202-6" data-line-number="6">  )</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 1 x 3</span><span>
##        </span><span style="font-weight: bold;">n</span><span> </span><span style="font-weight: bold;">mean_air_time</span><span> </span><span style="font-weight: bold;">median_air_time</span><span>
##    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>         </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span> </span><span style="text-decoration: underline;">336</span><span>776          151.             129
</span></code></pre>
<p>The <code>summarize()</code> verb gains its full power in grouped operations.
Surround with <code>group_by()</code> and <code>ungroup()</code> to compute summaries in groups defined by common values in one or more columns.
In the next example, the same summary is computed separately for each origin airport.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb203-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(origin) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb203-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb203-4" data-line-number="4">    <span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb203-5" data-line-number="5">    <span class="dt">mean_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb203-6" data-line-number="6">    <span class="dt">median_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb203-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb203-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 3 x 4</span><span>
##   </span><span style="font-weight: bold;">origin</span><span>      </span><span style="font-weight: bold;">n</span><span> </span><span style="font-weight: bold;">mean_air_time</span><span> </span><span style="font-weight: bold;">median_air_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>         </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span> EWR    </span><span style="text-decoration: underline;">120</span><span>835          153.             130
## </span><span style="color: #555555;">2</span><span> JFK    </span><span style="text-decoration: underline;">111</span><span>279          178.             149
## </span><span style="color: #555555;">3</span><span> LGA    </span><span style="text-decoration: underline;">104</span><span>662          118.             115
</span></code></pre>
<p>Conceptually this corresponds to the following sequence of operations:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Split</strong> the dataset into groups defined by the values of the <code>origin</code> column.
Each group has the same value in <code>origin</code>.</li>
<li>
<strong>Apply</strong> the same summary for each group.
In this case, the size, mean air time, and median air time is computed
across all flights for each group.</li>
<li>
<strong>Combine</strong> the results into one data frame.
The grouping variables and the results are bound together for further analysis.</li>
</ol>
<p>More often than not, the question “how do I iterate over each group and do …” can be reprased as “what summary value do I want to compute for each group”.
Recognizing this takes a bit of practice but is worth the effort, because the analysis code becomes shorter and more robust and often runs faster.</p>
<p>Groups can be defined over multiple columns as well.
The next example splits the data into one group for each day.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb204-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb204-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb204-4" data-line-number="4">    <span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb204-5" data-line-number="5">    <span class="dt">mean_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb204-6" data-line-number="6">    <span class="dt">median_air_time =</span> <span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb204-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb204-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 365 x 6</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span>     </span><span style="font-weight: bold;">n</span><span> </span><span style="font-weight: bold;">mean_air_time</span><span> </span><span style="font-weight: bold;">median_air_time</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>         </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1   842          170.             149
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     2   943          162.             148
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     3   914          157.             148
## </span><span style="color: #555555;"># … with 362 more rows</span><span>
</span></code></pre>
<p>For quick exploration, the names of the new columns can be omitted:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb205-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb205-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb205-4" data-line-number="4">    <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb205-5" data-line-number="5">    <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb205-6" data-line-number="6">    <span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(air_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb205-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb205-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 365 x 6</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span> </span><span style="font-weight: bold;">`n()`</span><span> </span><span style="font-weight: bold;">`mean(air_time, n…</span><span> </span><span style="font-weight: bold;">`median(air_time…</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>              </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>             </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1   842               170.               149
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     2   943               162.               148
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     3   914               157.               148
## </span><span style="color: #555555;"># … with 362 more rows</span><span>
</span></code></pre>
<p>The <code>n()</code> function computes a simple count, and is one of the most frequently used summary functions.
The <code>count()</code> function provides a convenient alternative.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb206-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(year, month, day)</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 365 x 4</span><span>
##    </span><span style="font-weight: bold;">year</span><span> </span><span style="font-weight: bold;">month</span><span>   </span><span style="font-weight: bold;">day</span><span>     </span><span style="font-weight: bold;">n</span><span>
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     1   842
## </span><span style="color: #555555;">2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     2   943
## </span><span style="color: #555555;">3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     1     3   914
## </span><span style="color: #555555;"># … with 362 more rows</span><span>
</span></code></pre>
<div id="exercises-5" class="section level3 unnumbered">
<h3>Exercises</h3>
<p><a href="https://krlmlr.github.io/vistransrep/2019-11-zhr/summarize.html" class="uri">https://krlmlr.github.io/vistransrep/2019-11-zhr/summarize.html</a></p>
<p><a href="https://krlmlr.github.io/vistransrep/2019-11-zhr/summarize-mult.html" class="uri">https://krlmlr.github.io/vistransrep/2019-11-zhr/summarize-mult.html</a></p>
</div>
</div>
<div id="summary-plots" class="section level2">
<h2>
<span class="header-section-number">3.8</span> Summary-plots</h2>
<details><p><summary><em>Click here to show setup code.</em></summary></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb207-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</a>
<a class="sourceLine" id="cb207-3" data-line-number="3"></a>
<a class="sourceLine" id="cb207-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(conflicted)</a>
<a class="sourceLine" id="cb207-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::filter[39m over any other package</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</a></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer [34mdplyr::lag[39m over any other package</code></pre>
</details><p>Potentially surprisingly, <code>mutate()</code> can also work with the results of a <code>ggplot()</code> call.
Let’s approach this step by step.
Here is a basic barplot of <code>flights$carrier</code>:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb213-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> carrier)) <span class="op">+</span></a>
<a class="sourceLine" id="cb213-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/28-bar-plot-flights-per-carrier-1.png" width="624" style="display: block; margin: auto;"></p>
<p>Same with one facet per month:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> carrier)) <span class="op">+</span></a>
<a class="sourceLine" id="cb214-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb214-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>month)</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/28-bar-plot-flights-per-carrier-one-facet-per-month-1.png" width="624" style="display: block; margin: auto;"></p>
<p>We can extract a function that takes any data and produces a barplot of the variable <code>carrier</code>:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1">plot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb215-2" data-line-number="2">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-3" data-line-number="3"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> carrier)) <span class="op">+</span></a>
<a class="sourceLine" id="cb215-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_bar</span>()</a>
<a class="sourceLine" id="cb215-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb215-6" data-line-number="6"></a>
<a class="sourceLine" id="cb215-7" data-line-number="7"><span class="kw">plot_fun</span>(flights)</a></code></pre></div>
<p><img src="vistransrep_files/figure-html/28-extract-a-function-1.png" width="624" style="display: block; margin: auto;"></p>
<p>The result of <code>ggplot()</code> is first and foremost an object.
Only when R tries to display it on the console a method is triggered, which causes it to show the graph in the “Viewer”.
Therefore, we can use the <code>group_by</code> – <code>summarize()</code> – <code>ungroup()</code> pattern to produce one plot per group and store it in a new column:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" data-line-number="1">plot_df &lt;-</a>
<a class="sourceLine" id="cb216-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb216-5" data-line-number="5">    <span class="dt">plot =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">plot_fun</span>(<span class="kw">tibble</span>(carrier)))</a>
<a class="sourceLine" id="cb216-6" data-line-number="6">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb216-8" data-line-number="8"></a>
<a class="sourceLine" id="cb216-9" data-line-number="9">plot_df</a></code></pre></div>
<pre class="fansi fansi-output"><code>## <span style="color: #555555;"># A tibble: 12 x 2</span><span>
##   </span><span style="font-weight: bold;">month</span><span> </span><span style="font-weight: bold;">plot</span><span>  
##   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;list&gt;</span><span>
## </span><span style="color: #555555;">1</span><span>     1 </span><span style="color: #555555;">&lt;gg&gt;</span><span>  
## </span><span style="color: #555555;">2</span><span>     2 </span><span style="color: #555555;">&lt;gg&gt;</span><span>  
## </span><span style="color: #555555;">3</span><span>     3 </span><span style="color: #555555;">&lt;gg&gt;</span><span>  
## </span><span style="color: #555555;"># … with 9 more rows</span><span>
</span></code></pre>
<p>When using <code><a href="https://dplyr.tidyverse.org/reference/pull.html">dplyr::pull()</a></code> (this function “extracts” a variable from a <code>data.frame</code> and returns it as a normal vector), each of the plots will be subsequently displayed in your “Viewer”.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1">plot_df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb217-2" data-line-number="2"><span class="st">  </span><span class="kw">pull</span>()</a></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-1.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-2.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-3.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-4.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-5.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-6.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-7.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-8.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-9.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[10]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-10.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[11]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-11.png" width="624" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[12]]</code></pre>
<p><img src="vistransrep_files/figure-html/28-show-the-plots-12.png" width="624" style="display: block; margin: auto;"></p>
<p>Use the left arrow to click through the different plots.</p>

</div>
</div>
            </section>
</div>
        </div>
      </div>
<a href="vis-basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="import.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script><script src="libs/gitbook/js/lunr.js"></script><script src="libs/gitbook/js/clipboard.min.js"></script><script src="libs/gitbook/js/plugin-search.js"></script><script src="libs/gitbook/js/plugin-sharing.js"></script><script src="libs/gitbook/js/plugin-fontsettings.js"></script><script src="libs/gitbook/js/plugin-bookdown.js"></script><script src="libs/gitbook/js/jquery.highlight.js"></script><script src="libs/gitbook/js/plugin-clipboard.js"></script><script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["vistransrep.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
